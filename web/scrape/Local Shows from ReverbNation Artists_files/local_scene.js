define("angular_helper",["angular"],function(){var e=Object.prototype.toString,t=function(t){return"[object Arguments]"===e.apply(t)||null!==t&&void 0!==t&&!!t.callee},n=function(t){return"[object Array]"===e.apply(t)},a=function(e){return"string"==typeof e},o=function(e){if(t(e)||n(e))return o.apply(null,e);if(e&&e.id)return e.id;throw"Unable to extract AngularJS module name from RequireJS module: "+e},r=function(){var e=[];return angular.forEach(arguments,function(o){t(o)||n(o)?e.push.apply(e,r.apply(null,o)):a(o)?e.push(o):o&&o.name&&n(o.requires)&&e.push(o.name)}),e},i=function(){var e=o(arguments),t=r.apply(null,arguments);return angular.module(e,t)},c=function(){var e=arguments;return function(t,n){var a=i(e);a.config(["ConfigProvider",function(e){e.setConfig(n)}]),angular.bootstrap(t,[a.name],{strictDi:!0})}},s=function(e,t){function n(n,a){var o=function(e){n.$evalAsync(function(){n[a]=angular.copy(e,n[a])})};n.$on("$destroy",e.$watch(t,o,!0)),o(e.$eval(t))}return n};return{configBootstrapper:c,createModule:i,scopeBinder:s}}),define("common/angular/services/log",["module","angular_helper"],function(e,t){return t.createModule(arguments).factory("$log",["$window",function(e){return e.Reverb}])}),define("common/angular/services/exception_handler",["module","angular_helper","common/angular/services/log"],function(e,t){return t.createModule(arguments).factory("$exceptionHandler",["$log","$window",function(e,t){return function(n,a){e.error(n.stack,a),t.Hoptoad&&t.Hoptoad.notify(n)}}])}),define("common/angular/config/csrf_protection",["module","angular_helper"],function(e,t){var n=t.createModule(arguments);return n.factory("CSRFToken",[function(){return{get:function(){var e=angular.element("[name=csrf-token]");return e.length<1?null:e[0].content}}}]),n}),define("common/angular/config/location_provider",["module","angular_helper"],function(e,t){var n,a=parseInt((/android (\d+)/.exec(angular.lowercase((window.navigator||{}).userAgent))||[])[1],10),o=/Boxee/i.test((window.navigator||{}).userAgent);return n=!window.history||!window.history.pushState||4>a||o?!1:{enabled:!0,requireBase:!1,rewriteLinks:!0},Reverb.log("html5mode",n),t.createModule(arguments).value("$html5mode",n).config(["$locationProvider",function(e){e.html5Mode(n),e.hashPrefix("!")}]).run(["$window","$log","$rootScope","$rootElement","$location",function(e,t,n,a,o){n.$root._$location=o,e.rootScopes=e.rootScopes||[],e.rootScopes.push(n),a.on("$destroy",function(){t.debug("Destroying $rootScope:",n.$id),n.$destroy(),e.rootScopes.splice(e.rootScopes.indexOf(n),1)}),n.$on("$locationChangeStart",function(t,n,a,o,r){var i=[];angular.forEach(e.rootScopes,function(e){e._$perform_navigation?i.push(e):e.$broadcast("$globalLocationChangeStart",n,a,o,r)}),angular.forEach(i,function(e){e.$broadcast("$globalLocationChangeStart",n,a,o,r)})}),n.$on("$locationChangeSuccess",function(t,a,r){angular.forEach(e.rootScopes,function(e){e!==n&&a!==r&&e.$evalAsync(function(){e._$location.url(o.url())})})})}])}),define("common/angular/config/prevent_navigation",["module","angular_helper","common/angular/config/location_provider"],function(e,t){return t.createModule(arguments).run(["$rootElement","$html5mode",function(e,t){t&&e.on("click",function(e){e&&e.originalEvent&&(e.originalEvent.ngSuppressed=!0)})}])}),define("common/angular/config/sce_delegate_whitelist",["module","angular_helper"],function(e,t){return t.createModule(arguments).config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self",/^https?\:\/\/(?:[^\/]*\.)?edgecastcdn\.net\/.*/,/^https?\:\/\/(?:[^\/]*\.)?reverbnation\.com\/.*/,/^https?\:\/\/(?:[^\/]*\.)?soniclemur\.com\/.*/,/^https?\:\/\/(?:[^\/]*\.)?eartight\.com\/.*/,/^https?\:\/\/(?:[^\/]*\.)?tunehive\.com\/.*/,/^https?\:\/\/djj-tunehive-cdn\.ngrok\.io\/.*/])}])}),define("common/angular/main_site_essential",["module","angular_helper","common/angular/services/exception_handler","common/angular/services/log","common/angular/config/csrf_protection","common/angular/config/location_provider","common/angular/config/prevent_navigation","common/angular/config/sce_delegate_whitelist"],function(e,t){return t.createModule(arguments)}),define("common/angular/components/pagination",["module","angular_helper"],function(e,t){return t.createModule(arguments).factory("PaginationService",[function(){return{addPagination:function(e,t,n,a){var o=1,r=[];n=n||3,a=a||5,t.then?t.then(function(e){return r=e,e}):r=t,e.getTotalItems=function(){return r.length},e.getMaxSize=function(){return a},e.getPageSize=function(){return n},e.setPageSize=function(e){n=e},e.getNumberOfPages=function(){return Math.ceil(r.length/n)},e.getCurrentPage=function(){return Math.max(1,Math.min(e.getNumberOfPages(),o))},e.setCurrentPage=function(t){o=Math.max(1,Math.min(e.getNumberOfPages(),t))},e.getCurrentPageStart=function(){return(e.getCurrentPage()-1)*n},e.getCurrentPageEnd=function(){return Math.min(r.length,e.getCurrentPage()*n-1)},e.getPageNumberForItem=function(e){return Math.max(1,Math.ceil((r.indexOf(e)+1)/n))},e.disablePagination=function(){n=Number.MAX_VALUE}}}}]).filter("paginate",[function(){return function(e,t,n){return angular.isArray(e)?e.slice(t,n+1):[]}}]).run(["$templateCache",function(e){var t=["<div>",'<div ng-if="useFoundation == true">','<ul class="pagination">','<li ng-repeat="page in pages" ng-class="{current: page.active, unavailable: page.disabled, arrow: page.previous || page.next, \'n-of-n\': page.nOfN}">',"<a ng-if=\"!page.nOfN\" ng-click=\"selectPage(page.number)\" ng-class=\"{'qa-current-page': page.active, 'qa-previous-page': page.previous, 'qa-next-page': page.next, '{{'qa-page-' + page.text}}': page.text, 'qa-last-page': {{page.number === totalPages}} }\">{{page.text}}</a>",'<span ng-if="page.nOfN">{{page.text}}</span>',"</li>","</ul>","</div>",'<div class="pagination" ng-if="useFoundation != true">',"<ul>",'<li ng-repeat="page in pages" ng-class="{active: page.active, disabled: page.disabled}">','<a ng-click="selectPage(page.number)">{{page.text}}</a>',"</li>","</ul>","</div>","</div>"].join(""),n=['<div class="pager">',"<ul>",'<li ng-repeat="page in pages" ng-class="{disabled: page.disabled, previous: page.previous, next: page.next}">','<a ng-click="selectPage(page.number)">{{page.text}}</a>',"</li>","</ul>","</div>"].join("");e.put("template/pagination/pagination.html",t),e.put("template/pagination/pager.html",n)}]).controller("PaginationController",["$scope","$attrs","$parse","$interpolate",function(e,t,n,a){var o=this,r=t.numPages?n(t.numPages).assign:angular.noop;this.init=function(a){t.itemsPerPage?e.$parent.$watch(n(t.itemsPerPage),function(t){o.itemsPerPage=parseInt(t,10),e.totalPages=o.calculateTotalPages()}):this.itemsPerPage=a},this.noPrevious=function(){return 1===this.page},this.noNext=function(){return this.page===e.totalPages},this.isActive=function(e){return this.page===e},this.calculateTotalPages=function(){var t=this.itemsPerPage<1?1:Math.ceil(e.totalItems/this.itemsPerPage);return Math.max(t||0,1)},this.getAttributeValue=function(t,n,o){return angular.isDefined(t)?o?a(t)(e.$parent):e.$parent.$eval(t):n},this.render=function(){this.page=parseInt(e.page,10)||1,this.page>0&&this.page<=e.totalPages&&(e.pages=this.getPages(this.page,e.totalPages))},e.selectPage=function(t){!o.isActive(t)&&t>0&&t<=e.totalPages&&(e.page=t,e.onSelectPage({page:t}))},e.$watch("page",function(){o.render()}),e.$watch("totalItems",function(){e.totalPages=o.calculateTotalPages()}),e.$watch("totalPages",function(t){r(e.$parent,t),o.page>t?e.selectPage(t):o.render()})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function(e,t){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &",useFoundation:"="},controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(n,a,o,r){function i(e,t,n,a){return{number:e,text:t,active:n,disabled:a}}var c,s=r.getAttributeValue(o.boundaryLinks,t.boundaryLinks),l=r.getAttributeValue(o.directionLinks,t.directionLinks),u=r.getAttributeValue(o.firstText,t.firstText,!0),g=r.getAttributeValue(o.previousText,t.previousText,!0),p=r.getAttributeValue(o.nextText,t.nextText,!0),f=r.getAttributeValue(o.lastText,t.lastText,!0),d=r.getAttributeValue(o.rotate,t.rotate);r.init(t.itemsPerPage),o.maxSize&&n.$parent.$watch(e(o.maxSize),function(e){c=parseInt(e,10),r.render()}),r.getPages=function(e,t){var a=[],h=1,_=t,m=angular.isDefined(c)&&t>c;m&&(d?(h=Math.max(e-Math.floor(c/2),1),_=h+c-1,_>t&&(_=t,h=_-c+1)):(h=(Math.ceil(e/c)-1)*c+1,_=Math.min(h+c-1,t)));for(var v=h;_>=v;v++){var y=i(v,v,r.isActive(v),!1);a.push(y)}if(m&&!d){if(h>1){var E=i(h-1,"...",!1,!1);a.unshift(E)}if(t>_){var b=i(_+1,"...",!1,!1);a.push(b)}}if(n.$eval(o.useFoundation)){var P=i(e,e+" of "+t,!1,!1);P.nOfN=!0,a.unshift(P)}if(l){var w=i(e-1,g,!1,r.noPrevious());w.previous=!0,a.unshift(w);var A=i(e+1,p,!1,r.noNext());A.next=!0,a.push(A)}if(s){var T=i(1,u,!1,r.noPrevious());a.unshift(T);var R=i(t,f,!1,r.noNext());a.push(R)}return a}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"« Previous",nextText:"Next »",align:!0}).directive("pager",["pagerConfig",function(e){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &",useFoundation:"="},controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(t,n,a,o){function r(e,t,n,a,o){return{number:e,text:t,disabled:n,previous:s&&a,next:s&&o}}var i=o.getAttributeValue(a.previousText,e.previousText,!0),c=o.getAttributeValue(a.nextText,e.nextText,!0),s=o.getAttributeValue(a.align,e.align);o.init(e.itemsPerPage),o.getPages=function(e){return[r(e-1,i,o.noPrevious(),!0,!1),r(e+1,c,o.noNext(),!1,!0)]}}}}])}),define("common/angular/directives/event_listener",["module","angular_helper"],function(e,t){return t.createModule(arguments).directive("eventListener",["$window",function(e){return{restrict:"A",scope:{eventListener:"@"},link:function(t,n){function a(e,n){function a(e,a){t.$evalAsync(function(){t.$emit(n,e,a)})}var o=n.indexOf(":"),r=n.substring(o+1);e.bind(r,a),t.$on("$destroy",function(){e.unbind(n,a)})}var o=t.eventListener.replace(/\s/g,"").split(",");angular.forEach(o,function(o){var r=o.split(":");if(r.length<2)throw new Error("Invalid event specification: "+o);switch(r[0]){case"reverb":if(3!=r.length)throw new Error("Invalid Reverb.Event specification: "+o);n.addClass(r[1]+"_event_handler"),n.bind(r[1]+":"+r[2],function(e,n){t.$evalAsync(function(){t.$emit(o,e,n)})});break;case"window":a(jQuery(e),o);break;case"music_player":a(MusicPlayer.getInstance(),o);break;default:throw new Error("Invalid event specification: "+o)}})}}}])}),define("common/angular/config/config",["module","angular_helper"],function(e,t){return t.createModule(arguments).provider("Config",[function(){var e=function(t){return angular.forEach(arguments,function(n){n!==t&&angular.forEach(n,function(n,a){t[a]&&t[a].constructor&&t[a].constructor===Object?e(t[a],n):t[a]=n})}),t},t={};this.setConfig=function(n){t=e({},t,n)},this.$get=[function(){return t}]}])}),void 0===window.Reverb&&(window.Reverb={}),Reverb.LocalSceneHelper=function(){var e={GEO:"geo",GEO_COUNTRY:"country",GEO_STATE:"state",GEO_CITY:"city",GEO_ZIP:"postal_code",RANGE_TYPE:"range_type",RANGE_DATE:"range_date",PAGE:"page"},t={TODAY:"today",TOMORROW:"tomorrow",WEEKEND:"weekend",DATE:"date",FULL:"full"},n=function(){var n=function(e){return e&&"string"==typeof e&&e.length?e:void 0};this._params={geo:"local"},this.for_geo_location=function(e){return this.for_country(e.country).for_state(e.state).for_city(e.city).for_zip(e.postal_code||e.zip)},this.for_country=function(t){return this._params[e.GEO_COUNTRY]=n(t),this},this.for_state=function(t){return this._params[e.GEO_STATE]=n(t),this},this.for_city=function(t){return this._params[e.GEO_CITY]=n(t),this},this.for_zip=function(t){return this._params[e.GEO_ZIP]=t,this},this.for_range_type=function(t){return this._params[e.RANGE_TYPE]=t,this},this.for_date=function(n){var a=null;if(n instanceof Date){var o=n.getFullYear(),r=(1+n.getMonth()).toString();r=r.length>1?r:"0"+r;var i=n.getDate().toString();i=i.length>1?i:"0"+i,a=r+"/"+i+"/"+o}else"string"==typeof n&&(a=n);return this.for_range_type(t.DATE),this._params[e.RANGE_DATE]=a,this},this.for_page=function(t){return this._params[e.PAGE]=t,this},this.params=function(){return _.clone(this._params)},this.query=function(){return _.map(this._params,function(e,t){return void 0!==e?t+"="+e:""}).join("&")},this.url=function(){return"/main/local_scene?"+this.query()},this.go=function(){this._validate()&&Reverb.Navigate.go_to_page_url(this.url())},this._validate=function(){var t=this._params,n=!t[e.GEO_COUNTRY]&&!t[e.GEO_CITY]||t[e.GEO_COUNTRY]&&t[e.GEO_CITY];if(!n)try{throw"Invalid local scene state.  Country and City are both required if either is supplied.  You provided "+JSON.stringify(this._params)}catch(a){if("production"!=Reverb.config.env)throw a;Reverb.error(a),Reverb.ErrorNotifier&&Reverb.ErrorNotifier.notify(a)}return!0}},a={PARAM_KEYS:e,RANGE_TYPES:t};return _.each(["for_geo_location","for_country","for_state","for_city","for_zip","for_page","for_range_type","for_date"],function(e){a[e]=function(){var t=new n;return t[e].apply(t,arguments)}}),a}(),define("main/local_scene_helper",function(){}),void 0===window.Reverb&&(window.Reverb={}),Reverb.ChartHelper=function(){var e={GENRE:"genre",ARTIST:"artist_id",GEO_TYPE:"geo",GEO_COUNTRY:"country",GEO_STATE:"state",GEO_CITY:"city",GEO_ZIP:"postal_code",GEO_REGION:"region",PAGE:"page"},t={GLOBAL:"global",NATIONAL:"national",REGIONAL:"regional",LOCAL:"local"},n=function(){var n=function(e){return e&&"string"==typeof e&&e.length?e:void 0};this._params={},this.for_artist=function(t){return this._params[e.ARTIST]=t,this},this.global=function(){return this.for_geo_type(t.GLOBAL)},this.national=function(e){return this.for_geo_type(t.NATIONAL),e&&this.for_country(e),this},this.regional=function(e){return this.for_geo_type(t.REGIONAL),e&&this.for_region(e),this},this.local=function(){return this.for_geo_type(t.LOCAL)},this.for_geo_type=function(t){return this._params[e.GEO_TYPE]=t,this},this.for_geo_location=function(e){return this.for_country(e.country).for_state(e.state).for_city(e.city).for_zip(e.postal_code||e.zip).for_region(e.region)},this.for_country=function(t){return this._params[e.GEO_COUNTRY]=n(t),this},this.for_state=function(t){return this._params[e.GEO_STATE]=n(t),this},this.for_city=function(t){return this._params[e.GEO_CITY]=n(t),this},this.for_zip=function(t){return this._params[e.GEO_ZIP]=t,this},this.for_region=function(t){return this._params[e.GEO_REGION]=t,this},this.for_genre=function(t){return this._params[e.GENRE]=t,this},this.for_page=function(t){return this._params[e.PAGE]=t,this},this.params=function(){return _.clone(this._params)},this.query=function(){return _.map(this._params,function(e,t){return void 0!==e?t+"="+e:""}).join("&")},this.url=function(){return"/main/charts?"+this.query()},this.go=function(){this._validate()&&Reverb.Navigate.go_to_page_url(this.url())},this._validate=function(){var n=this._params,a=!this._params[e.GEO_TYPE]||n[e.GEO_TYPE]==t.GLOBAL||n[e.GEO_TYPE]==t.NATIONAL&&n[e.GEO_COUNTRY]||n[e.GEO_TYPE]==t.REGIONAL&&n[e.GEO_REGION]||n[e.GEO_TYPE]==t.LOCAL&&n[e.GEO_COUNTRY]&&n[e.GEO_CITY];if(!a)try{throw"Invalid chart state.  National charts require country, regional charts require region and local charts require both country and city.  You provided "+JSON.stringify(this._params)}catch(o){if("production"!=Reverb.config.env)throw o;Reverb.error(o),Reverb.ErrorNotifier&&Reverb.ErrorNotifier.notify(o)}return!0}},a={PARAM_KEYS:e,GEO_TYPES:t};return _.each(["for_artist","for_geo_type","for_geo_location","for_country","for_state","for_city","for_zip","for_region","for_genre","for_page","global","national","regional","local"],function(e){a[e]=function(){var t=new n;return t[e].apply(t,arguments)}}),a}(),define("main/chart_helper",function(){}),window.Reverb||(window.Reverb={}),Reverb.GeoLocation=function(){var e=function(e){var t="/main/change_location?action_forward=trigger_updated_object";e===!1&&(t+="&no_session=true"),window.modal_open(t)},t=function(e){var t=[];return e&&(e.city&&t.push(e.city),e.state&&t.push(e.state),e.country&&t.push(e.country)),t.join(", ")},n=function(e){var t=[];return t.push(e.city||""),t.push(e.state||""),t.push(e.country||""),t.join("_")};return{show_modal:e,display_string_for_location:t,region_string_for_location:n}}(),define("main/geo_location_utils",function(){}),define("common/angular/directives/autocomplete",["module","angular_helper"],function(e,t){var n=t.createModule(arguments);return n.directive("ngAutocomplete",["$parse",function(){return{require:"ngModel",scope:{ngModel:"=",options:"=?",details:"=?"},link:function(e,t,n,a){Reverb.GMaps.ready(function(){var n,o=!1,r=function(){n={},e.options&&(o=e.options.watchEnter!==!0?!1:!0,e.options.types?(n.types=[],n.types.push(e.options.types),e.gPlace.setTypes(n.types)):e.gPlace.setTypes([]),e.options.bounds?(n.bounds=e.options.bounds,e.gPlace.setBounds(n.bounds)):e.gPlace.setBounds(null),e.options.country?(n.componentRestrictions={country:e.options.country},e.gPlace.setComponentRestrictions(n.componentRestrictions)):e.gPlace.setComponentRestrictions(null))};void 0==e.gPlace&&(e.gPlace=new google.maps.places.Autocomplete(t[0],{})),google.maps.event.addListener(e.gPlace,"place_changed",function(){var n=e.gPlace.getPlace();void 0!==n&&(void 0!==n.address_components?e.$apply(function(){e.details=n,a.$setViewValue(t.val())}):o&&i(n))});var i=function(n){var o=new google.maps.places.AutocompleteService;n.name.length>0&&o.getPlacePredictions({input:n.name,offset:n.name.length},function(n){if(null==n||0==n.length)e.$apply(function(){e.details=null});else{var o=new google.maps.places.PlacesService(t[0]);o.getDetails({reference:n[0].reference},function(n,o){o==google.maps.GeocoderStatus.OK&&e.$apply(function(){a.$setViewValue(n.formatted_address),t.val(n.formatted_address),e.details=n;t.on("focusout",function(){t.val(n.formatted_address),t.unbind("focusout")})})})}})};a.$render=function(){var e=a.$viewValue;t.val(e)},e.watchOptions=function(){return e.options},e.$watch(e.watchOptions,function(){r()},!0)})}}}])}),define("local_scene/controllers/local_scene",["module","angular_helper","main/local_scene_helper","main/chart_helper","main/geo_location_utils","common/angular/directives/autocomplete"],function(e,t){var n=t.createModule(arguments),a=["$scope","$http","$window","$location","Config"],o=function(e,t,n,a,o){e.shows=[],e.displayDate="",e.loading=!1,e.spinnerClass="hidden",e.showFilters=o.showFilters,e.filters=angular.copy(o.filters,{}),e.page=o.page,e.per_page=o.per_page,e.countries=o.countries,e.geoOptions=[{label:"Global",value:"global"},{label:"National",value:"country"},{label:"Local",value:"local"}],e.datepickerDate="",e.showDatePicker=function(t){var n=jQuery(t.target).siblings("input");n.css("display","inline");var a={dateFormat:"mm/dd/yy",defaultDate:7,onSelect:function(t){e.datepickerDate!=t&&(e.datepickerDate=t,e.filters.range.type="date",e.filters.range.date=t,e.updateFilters())},onClose:function(){n.css("display","none"),n.datepicker("destroy"),n.removeClass("hasDatepicker").removeAttr("id")}};n.datepicker(a),n.focus()};var r=angular.copy(e.filters,{});e.goToShow=function(e){"#"!=e.venue_link&&Reverb.Navigate.go_to_page_url("/show/"+e.show_id)},e.disableUpdateButtonForLocal=function(){e.updateButtonEnabledForLocal=!1},e.toggleFilters=function(){e.showFilters=!e.showFilters,e.showFilters||(e.pendingLocation=null)},e.updateFilters=function(){e.pendingLocation&&(e.filters.location=angular.copy(e.pendingLocation,{}),Reverb.Event.trigger("charts:refresh_sponsored_artists",e.filters.location)),r=angular.copy(e.filters,{}),e.setPage(1),e.showFilters&&e.toggleFilters(),e.updateTitle()},e.$watch("autocomplete_local.temp_place",function(t){if(t){var n={geo:Reverb.ChartHelper.GEO_TYPES.LOCAL,city:"",state:"",postal_code:"",country:"",region:null,latitude:t.geometry.location.lat(),longitude:t.geometry.location.lng()};_.each(t.address_components,function(e){var t=e.types,a=e.short_name;a&&(t.include("locality")?n.city=a:t.include("administrative_area_level_1")?n.state=a:t.include("postal_code")?n.postal_code=a:t.include("country")&&(n.country=a.replace("GB","UK")))}),e.pendingLocation=n,e.updateButtonEnabledForLocal=!0}}),e.getTotalItems=function(){return e.total_entries},e.needsPagination=function(){return e.showsAvailable()&&e.getTotalItems()>o.per_page},e.updateBookmark=function(){a.replace(),_.each(Reverb.LocalSceneHelper.PARAM_KEYS,function(e){a.search(e,null)});var t=Reverb.LocalSceneHelper.for_geo_location(r.location).for_page(e.page);t.for_range_type(r.range.type),r.range.type==Reverb.LocalSceneHelper.RANGE_TYPES.DATE&&t.for_date(r.range.date),a.search(t.params())};var i=function(e){return"string"==typeof e?e:void 0},c=[Reverb.LocalSceneHelper.PARAM_KEYS.GEO,Reverb.LocalSceneHelper.PARAM_KEYS.GEO_COUNTRY,Reverb.LocalSceneHelper.PARAM_KEYS.GEO_STATE,Reverb.LocalSceneHelper.PARAM_KEYS.GEO_CITY],s=function(e){return _.intersection(_.keys(e),c).length>0};e.interpretParams=function(){var t=a.search();s(t)&&(e.filters.location={}),_.each(_.keys(t),function(n){var a=t[n];if(a)switch(n){case Reverb.LocalSceneHelper.PARAM_KEYS.GEO:e.filters.location.geo=a;break;case Reverb.LocalSceneHelper.PARAM_KEYS.GEO_COUNTRY:e.filters.location.country=i(a);break;case Reverb.LocalSceneHelper.PARAM_KEYS.GEO_STATE:e.filters.location.state=i(a);break;case Reverb.LocalSceneHelper.PARAM_KEYS.GEO_CITY:e.filters.location.city=i(a);break;case Reverb.LocalSceneHelper.PARAM_KEYS.GEO_ZIP:e.filters.location.postal_code=a;break;case Reverb.LocalSceneHelper.PARAM_KEYS.PAGE:e.page=a;break;case Reverb.LocalSceneHelper.PARAM_KEYS.RANGE_TYPE:e.filters.range.type=a;break;case Reverb.LocalSceneHelper.PARAM_KEYS.RANGE_DATE:e.filters.range.date=a}}),r=angular.copy(e.filters,{})},e.setPage=function(t){e.loading=!0,e.page=t,e.updateBookmark(),e.loadShows(r)},e.loadShows=function(a){e.spinnerClass="",t({method:"GET",url:"/main/local_scene_data",params:angular.extend({},a,{page:e.page,per_page:o.per_page,window_size:o.window_size})}).success(function(t){var a;e.total_entries=t.total_entries,e.sceneDateTitle=t.display_date,e.displayDate="";for(var o=0;o<t.shows.length;o++)e.formatAtHour(t.shows[o]),e.formatVenueTitle(t.shows[o]),a=e.comparableShowtimeDate(t.shows[o].showtime),t.shows[o].showDate=a;e.shows=t.shows,e.loading=!1,e.spinnerClass="hidden",n.scrollTo(0,0)})},e.firstDate=function(){return e.showsAvailable()?data.shows[0].showDate:""},e.nowShowNewDate=function(t,n){return n>0&&t===e.displayDate?!1:(e.displayDate=t,!0)},e.comparableShowtimeDate=function(e){var t;return t=new Date(e),t.toDateString()},e.formatDate=function(e){var t;t=new Date(e);var n={weekday:"long",month:"long",day:"numeric"};return t.toLocaleDateString("en-US",n)},e.showsAvailable=function(){return e.shows.length>0},e.formatVenueTitle=function(e){var t=20;e.venue_name_truncated=e.venue_name.length>t?e.venue_name.substring(0,t)+"...":e.venue_name},e.formatAtHour=function(e){var t=new Date(e.showtime).getHours();mid=t>11?"pm":"am",t>12?t-=12:0===t&&(t=12),e.at_hour="@"+t+mid},e.localLocationString=function(e){var t=e.city;return e.state&&(t+=", "+e.state),t+=", "+e.country},e.updateTitle=function(){var t=r.location,n="",a="",o="";if("country"==t.geo){var i=_.filter(e.countries,function(e){return e.value==t.country})[0].label;n="National",a="in",o=i}else"local"==t.geo?(n="Local",a="in",o=e.localLocationString(t)):n="Global";e.geoTitle=n,e.inClause=a,e.geoLocation=o},e.setRange=function(t){e.filters.range.type=t,e.updateFilters()},e.getRange=function(){return e.filters.range.type},e.setPostal=function(t){e.filters.location.use_postal=t},e.interpretParams(),e.updateTitle(),e.loadShows(r),e.chartTitle=function(){return r.location.city||r.location.state||r.location.country},e.chartsUrl=function(){return Reverb.ChartHelper.local().for_geo_location(r.location).url()},e.$on("reverb:location:validated",function(t,n,a){e.filters.location=e.filters.location||{},e.filters.location.city=a.city,e.filters.location.state=a.state,e.filters.location.country=a.country,e.filters.location.postal_code=a.zip,e.updateFilters()})};return a.push(o),n.controller("LocalSceneCtrl",a),n}),define("common/angular/services/parse_url",["module","angular_helper"],function(e,t){var n=t.createModule(arguments);return n.factory("ParseURL",["$document",function(e){var t=e[0].createElement("a");return function(e){if(angular.isString(e)){var n=e.split("#!");return 1!=n.length&&(e=n[1]),t.href=e,{protocol:(t.protocol||"").split(":")[0],hostname:t.hostname,port:t.port,host:t.host,pathname:"/"==t.pathname[0]?t.pathname:"/"+t.pathname,search:t.search,hash:t.hash}}throw new Error("Invalid URL: "+e)}}]),n}),define("common/angular/config/query_param_skips_navigation",["module","angular_helper","common/angular/services/parse_url"],function(e,t){var n=t.createModule(arguments);return n.run(["$log","$rootScope","$location","ParseURL",function(e,t,n,a){var o=a(n.url()).pathname;t.$on("$globalLocationChangeStart",function(e,t){var n=a(t).pathname;o===n&&Reverb.Event.trigger("history:skip_navigation",t)})}]),n}),define("local_scene/config",["module","angular_helper"],function(e,t){return t.createModule(arguments).config(["ConfigProvider",function(e){e.setConfig({showFilters:!1,filters:{location:{geo:"Global",use_postal:!1},range:{type:"today",date:""}},page:1,per_page:10,sceneTitle:"Local Scene",updateOnLocationChange:!1})}])}),define("local_scene/app",["module","angular_helper","common/angular/main_site_essential","common/angular/components/pagination","common/angular/directives/event_listener","common/angular/config/config","local_scene/controllers/local_scene","common/angular/config/query_param_skips_navigation","local_scene/config"],function(e,t){return t.createModule(arguments,"LocalScene.Templates").run(["$rootElement","$rootScope",function(e,t){angular.element(e).on("$destroy",angular.bind(t,t.$destroy))}])}),define("local_scene/bootstrap",["module","angular_helper","local_scene/app"],function(e,t){return t.configBootstrapper(arguments)}),define("modules/local_scene",["local_scene/bootstrap"],function(e){return e});