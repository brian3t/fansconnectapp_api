/**
 * Copyright (c) 2011-2014 Felix Gnass
 * Licensed under the MIT license
 */

define("angular_helper",["angular"],function(){var e=Object.prototype.toString,n=function(n){return"[object Arguments]"===e.apply(n)||null!==n&&void 0!==n&&!!n.callee},r=function(n){return"[object Array]"===e.apply(n)},t=function(e){return"string"==typeof e},o=function(e){if(n(e)||r(e))return o.apply(null,e);if(e&&e.id)return e.id;throw"Unable to extract AngularJS module name from RequireJS module: "+e},i=function(){var e=[];return angular.forEach(arguments,function(o){n(o)||r(o)?e.push.apply(e,i.apply(null,o)):t(o)?e.push(o):o&&o.name&&r(o.requires)&&e.push(o.name)}),e},a=function(){var e=o(arguments),n=i.apply(null,arguments);return angular.module(e,n)},u=function(){var e=arguments;return function(n,r){var t=a(e);t.config(["ConfigProvider",function(e){e.setConfig(r)}]),angular.bootstrap(n,[t.name],{strictDi:!0})}},s=function(e,n){function r(r,t){var o=function(e){r.$evalAsync(function(){r[t]=angular.copy(e,r[t])})};r.$on("$destroy",e.$watch(n,o,!0)),o(e.$eval(n))}return r};return{configBootstrapper:u,createModule:a,scopeBinder:s}}),define("common/angular/services/log",["module","angular_helper"],function(e,n){return n.createModule(arguments).factory("$log",["$window",function(e){return e.Reverb}])}),define("common/angular/services/exception_handler",["module","angular_helper","common/angular/services/log"],function(e,n){return n.createModule(arguments).factory("$exceptionHandler",["$log","$window",function(e,n){return function(r,t){e.error(r.stack,t),n.Hoptoad&&n.Hoptoad.notify(r)}}])}),define("common/angular/config/csrf_protection",["module","angular_helper"],function(e,n){var r=n.createModule(arguments);return r.factory("CSRFToken",[function(){return{get:function(){var e=angular.element("[name=csrf-token]");return e.length<1?null:e[0].content}}}]),r}),define("common/angular/config/location_provider",["module","angular_helper"],function(e,n){var r,t=parseInt((/android (\d+)/.exec(angular.lowercase((window.navigator||{}).userAgent))||[])[1],10),o=/Boxee/i.test((window.navigator||{}).userAgent);return r=!window.history||!window.history.pushState||4>t||o?!1:{enabled:!0,requireBase:!1,rewriteLinks:!0},Reverb.log("html5mode",r),n.createModule(arguments).value("$html5mode",r).config(["$locationProvider",function(e){e.html5Mode(r),e.hashPrefix("!")}]).run(["$window","$log","$rootScope","$rootElement","$location",function(e,n,r,t,o){r.$root._$location=o,e.rootScopes=e.rootScopes||[],e.rootScopes.push(r),t.on("$destroy",function(){n.debug("Destroying $rootScope:",r.$id),r.$destroy(),e.rootScopes.splice(e.rootScopes.indexOf(r),1)}),r.$on("$locationChangeStart",function(n,r,t,o,i){var a=[];angular.forEach(e.rootScopes,function(e){e._$perform_navigation?a.push(e):e.$broadcast("$globalLocationChangeStart",r,t,o,i)}),angular.forEach(a,function(e){e.$broadcast("$globalLocationChangeStart",r,t,o,i)})}),r.$on("$locationChangeSuccess",function(n,t,i){angular.forEach(e.rootScopes,function(e){e!==r&&t!==i&&e.$evalAsync(function(){e._$location.url(o.url())})})})}])}),define("common/angular/config/prevent_navigation",["module","angular_helper","common/angular/config/location_provider"],function(e,n){return n.createModule(arguments).run(["$rootElement","$html5mode",function(e,n){n&&e.on("click",function(e){e&&e.originalEvent&&(e.originalEvent.ngSuppressed=!0)})}])}),define("common/angular/config/sce_delegate_whitelist",["module","angular_helper"],function(e,n){return n.createModule(arguments).config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self",/^https?\:\/\/(?:[^\/]*\.)?edgecastcdn\.net\/.*/,/^https?\:\/\/(?:[^\/]*\.)?reverbnation\.com\/.*/,/^https?\:\/\/(?:[^\/]*\.)?soniclemur\.com\/.*/,/^https?\:\/\/(?:[^\/]*\.)?eartight\.com\/.*/,/^https?\:\/\/(?:[^\/]*\.)?tunehive\.com\/.*/,/^https?\:\/\/djj-tunehive-cdn\.ngrok\.io\/.*/])}])}),define("common/angular/main_site_essential",["module","angular_helper","common/angular/services/exception_handler","common/angular/services/log","common/angular/config/csrf_protection","common/angular/config/location_provider","common/angular/config/prevent_navigation","common/angular/config/sce_delegate_whitelist"],function(e,n){return n.createModule(arguments)}),define("common/angular/components/dropdown",["module","angular_helper"],function(e,n){return n.createModule(arguments).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document","$log",function(e){var n=null;this.open=function(o){angular.element.fn.select2&&angular.element(".select2").select2("close"),n||(e.bind("click touchstart",r),e.bind("keydown",t)),n&&n!==o&&(n.isOpen=!1),n=o},this.close=function(o){n===o&&(n=null,e.unbind("click touchstart",r),e.unbind("keydown",t))},this.isOpen=function(){return!!n};var r=function(e){var r=n.getToggleElement();e&&r&&r[0].contains(e.target)||e&&angular.element(e.target).parents(".dropdown").length>0||n.$apply(function(){n.isOpen=!1})},t=function(e){27===e.which&&(n.focusToggleElement(),r())}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate",function(e,n,r,t,o,i){var a,u=this,s=e.$new(),c=t.openClass,l=angular.noop,d=n.onToggle?r(n.onToggle):angular.noop;this.init=function(t){u.$element=t,n.isOpen&&(a=r(n.isOpen),l=a.assign,e.$watch(a,function(e){s.isOpen=!!e}))},this.toggle=function(e){return s.isOpen=arguments.length?!!e:!s.isOpen},this.anyOpen=function(){return o.isOpen()},this.isOpen=function(){return s.isOpen},s.getToggleElement=function(){return u.toggleElement},s.focusToggleElement=function(){u.toggleElement&&u.toggleElement[0].focus()},s.$watch("isOpen",function(n,r){i[n?"addClass":"removeClass"](u.$element,c),n?(s.focusToggleElement(),o.open(s)):o.close(s),l(e,n),angular.isDefined(n)&&n!==r&&d(e,{open:!!n})}),e.$on("$locationChangeSuccess",function(){s.isOpen=!1}),e.$on("$destroy",function(){s.$destroy()})}]).directive("rnDropdown",function(){return{restrict:"CA",controller:"DropdownController",link:function(e,n,r,t){t.init(n)}}}).directive("rnDropdownToggle",function(){return{restrict:"CA",require:"?^rnDropdown",link:function(e,n,r,t){if(t){t.toggleElement=n;var o=function(o){o.preventDefault(),n.hasClass("disabled")||r.disabled||e.$apply(function(){t.toggle()})};n.bind("click",o),n.attr({"aria-haspopup":!0,"aria-expanded":!1}),e.$watch(t.isOpen,function(e){n.attr("aria-expanded",!!e)}),e.$on("$destroy",function(){n.unbind("click",o)})}}}})}),define("common/angular/directives/err_src",["module","angular_helper"],function(e,n){return n.createModule(arguments).directive("errSrc",[function(){return{restrict:"A",link:function(e,n,r){n.bind("error",function(){n.attr("src")!=r.errSrc&&n.attr("src",r.errSrc)})}}}])}),define("common/angular/directives/event_listener",["module","angular_helper"],function(e,n){return n.createModule(arguments).directive("eventListener",["$window",function(e){return{restrict:"A",scope:{eventListener:"@"},link:function(n,r){function t(e,r){function t(e,t){n.$evalAsync(function(){n.$emit(r,e,t)})}var o=r.indexOf(":"),i=r.substring(o+1);e.bind(i,t),n.$on("$destroy",function(){e.unbind(r,t)})}var o=n.eventListener.replace(/\s/g,"").split(",");angular.forEach(o,function(o){var i=o.split(":");if(i.length<2)throw new Error("Invalid event specification: "+o);switch(i[0]){case"reverb":if(3!=i.length)throw new Error("Invalid Reverb.Event specification: "+o);r.addClass(i[1]+"_event_handler"),r.bind(i[1]+":"+i[2],function(e,r){n.$evalAsync(function(){n.$emit(o,e,r)})});break;case"window":t(jQuery(e),o);break;case"music_player":t(MusicPlayer.getInstance(),o);break;default:throw new Error("Invalid event specification: "+o)}})}}}])}),define("common/angular/directives/history_manager",["module","angular_helper","common/angular/directives/event_listener"],function(e,n){var r=/^https?:\/\/[^\/]+/;return n.createModule(arguments).run(["$rootScope",function(e){e._$perform_navigation=!0}]).directive("skipNavigationEventListener",[function(){return{restrict:"A",link:function(e,n){Reverb.Event.bind("history:skip_navigation",n,function(n,t){e.skipNavigation=t.replace(r,"")})}}}]).directive("historyManager",["$window","$location","$log","$anchorScroll",function(e,n,t,o){return{restrict:"A",scope:{},template:'<div data-event-listener="reverb:history:navigate_to, reverb:history:replace_state, reverb:history:restore_scroll_position"><div data-skip-navigation-event-listener></div></div>',link:function(i){i.scrollPos={},i.$on("$globalLocationChangeStart",function(e,n,o){t.info("Location changed: "+o+" => "+n);var a=i.skipNavigation==n.replace(r,"");delete i.skipNavigation,a?t.debug("URL change has been explicitly skipped; not navigating.",n):o.replace("#","")!=n.replace("#","")&&Reverb.Navigate.go_to_page_url_direct(n)}),i.$on("reverb:history:navigate_to",function(r,o,a){i.$evalAsync(function(){t.info("history:navigate_to",a),Reverb.Modal.close();var r=angular.element(e).scrollTop();Reverb.Navigate.maintain_scroll_position&&(i.scrollPos[n.url()]=r);var o=encodeURI(a);i.scrollPos[o]=Reverb.Navigate.maintain_scroll_position_on_navigation?r:0,n.url(a)})}),i.$on("reverb:history:replace_state",function(e,r,o){i.$evalAsync(function(){t.info("history:replace_state",o),n.replace(),i.skipNavigation=o,n.url(o),Reverb.Navigate.set_current_url(o)})}),i.$on("reverb:history:restore_scroll_position",function(r,t,a){i.$evalAsync(function(){var r=n.hash();if(r&&0!=r.lastIndexOf("!",0))o();else{var t=i.scrollPos[n.url()];a||null!=t||(t=0),null!=t&&angular.element(e).scrollTop(t)}})})}}}])}),define("common/angular/services/safe_apply",["module","angular_helper"],function(e,n){return n.createModule(arguments).factory("SafeApply",["$rootScope",function(e){return function(n){e.$evalAsync(n)}}])}),define("common/angular/config/config",["module","angular_helper"],function(e,n){return n.createModule(arguments).provider("Config",[function(){var e=function(n){return angular.forEach(arguments,function(r){r!==n&&angular.forEach(r,function(r,t){n[t]&&n[t].constructor&&n[t].constructor===Object?e(n[t],r):n[t]=r})}),n},n={};this.setConfig=function(r){n=e({},n,r)},this.$get=[function(){return n}]}])}),define("common/angular/filters/capitalize",["module","angular_helper"],function(e,n){var r=n.createModule(arguments);return r.filter("capitalize",function(){return function(e){return e.substring(0,1).toUpperCase()+e.substring(1)}})}),define("header/filters/all",["module","angular_helper"],function(e,n){return n.createModule(arguments)}),define("common/angular/directives/progress_slider",["module","angular_helper"],function(e,n){var r=n.createModule(arguments);return r.directive("rnProgressSlider",[function(){var e=10;return{restrict:"A",replace:!0,require:"?ngModel",scope:{},template:'<div class="rn-progress-slider"><div class="rn-progress-slider-buffer"></div><div class="rn-progress-slider-gutter"><div class="rn-progress-slider-handle"><div class="rn-progress-slider-handle-indicator"></div></div></div></div>',link:function(n,r,t,o){function i(e){var n=e.touches&&e.touches.length?e.touches:[e],r=e.changedTouches&&e.changedTouches[0]||e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]||n[0].originalEvent||n[0];return{x:r.clientX,y:r.clientY}}function a(e){var n=r.offset(),t=r.width(),o=Math.min(Math.max(e.x,n.left),n.left+t)-n.left;u(100*o/t)}function u(e){o.$viewValue.hasOwnProperty("buffered")&&angular.isNumber(o.$viewValue.buffered)&&e>=o.$viewValue.buffered&&(e=o.$viewValue.buffered),s(m,e),n.$apply(function(){o.$viewValue.desired=e})}function s(e,n){n>=100?n=100:0>n&&(n=0),e.css("width",n+"%")}function c(e){v||e.isDefaultPrevented()||(v=!0,_=0,b=0,f=i(e),0===h.has(e.target).length&&a(f),e.stopPropagation(),e.preventDefault())}function l(n){if(v)if(0===(1&n.buttons)&&"mousemove"==n.type)d(n);else{var r=i(n);if(_+=Math.abs(r.x-f.x),b+=Math.abs(r.y-f.y),f=r,e>_&&e>b)return;b>_?d(n):(n.preventDefault(),a(r))}}function d(){v=!1}if(o){var f,p=angular.element("body"),g=r.find(".rn-progress-slider-buffer"),m=r.find(".rn-progress-slider-gutter"),h=r.find(".rn-progress-slider-handle"),v=!1,_=0,b=0;r.on("mousedown touchstart",c),p.on("mousemove touchmove",l),p.on("mouseup touchend touchcancel",d),n.$on("$destroy",function(){p.off("mousemove touchmove",l),p.off("mouseup touchend touchcancel",d)}),n.$watch(function(){return o.$viewValue.buffered},function(e){e>=100?g.hide():(g.show(),s(g,e))}),n.$watch(function(){return o.$viewValue.actual},function(e){s(m,e)})}}}}]),r}),define("common/angular/directives/bind_html_compile",["module","angular_helper"],function(e,n){return n.createModule(arguments).directive("bindHtmlCompile",["$compile",function(e){return{restrict:"A",link:function(n,r,t){n.$watch(function(){return n.$eval(t.bindHtmlCompile)},function(t){r.html(t),e(r.contents())(n)})}}}])}),define("header/directives/menu_item",["module","angular_helper","common/angular/directives/bind_html_compile"],function(e,n){var r=n.createModule(arguments);return r.directive("rnMenuItem",["$http","$templateCache","$compile",function(e,n,r){return{restrict:"A",scope:{menuItem:"=rnMenuItem",loggedIn:"=rnLoggedIn"},link:function(t,o){var i=t.menuItem;"logo"==i.id?i.display="<div rn-logo></div>":"star"==i.id?i.display="<div rn-star></div>":"search"==i.id?(i.display='<div rn-search-box hide-on-blur="true"></div>',i.noLink=!0):i.display='<span style="display: inline-block" class="selectable">'+i.title+"</span>",e.get("header/menu_items/"+i.type+".html",{cache:n}).success(function(e){o.html(r(e)(t))})}}}])}),define("common/angular/services/viewport",["module","angular_helper"],function(e,n){var r=["small","smallplus","medium","large","xlarge","xxlarge"];return n.createModule(arguments).constant("ViewportBreakpoints",angular.copy(r)).provider("Viewport",function(){var e=null,n=function(n,t,o){e=t.$new();var i=function(){e.orientation=o.matchMedia("(orientation: portrait)").matches?"portrait":"landscape",e.breakpoint=Reverb.Foundation.current_breakpoint};angular.element(o).on("resize",_.throttle(function(){e.$evalAsync(i)},50)),Reverb.Event.bind("rn_foundation:breakpoint",angular.element("body"),function(n,r,t){e.$evalAsync(function(){e.breakpoint=t})}),i(),e.is=function(n){var t=r.indexOf(n),o=r.indexOf(e.breakpoint);return t>=0&&o>=t},e.query=function(t){var o=t.split("-"),i=o[0],a=o[1],u=r.indexOf(i);if(0>u)return n.warn("Viewport query size must be one of",r,"not",i),!1;var s=["up","only"];if(s.indexOf(a)<0)return n.warn("Viewport query quantifier must be one of",s,"not",a),!1;var c=r.indexOf(e.breakpoint);if(0>c)return n.error("Viewport breakpoint is invalid!",e.breakpoint),!1;switch(a){case"up":return c>=u;case"only":return c==u}return n.error("Viewport: this should be unreachable"),!1}};this.$get=["$log","$rootScope","$window",function(r,t,o){return e||n(r,t,o),e.$new()}]})}),define("header/directives/rn_logo",["module","angular_helper","common/angular/services/viewport"],function(e,n){var r=n.createModule(arguments);return r.directive("rnLogo",["$window","Viewport",function(e,n){return{restrict:"A",replace:!0,link:function(e){function r(){e.useSmall=!n.is("smallplus")}function t(){return n.is("large")&&!n.is("xlarge")}e.$on("$destroy",n.$watch("breakpoint",r)),r(),e.getTemplateUrl=function(){return e.useSmall?"header/logo_small.html":t()?"header/logo_x_small.html":"header/logo_big.html"}},template:'<div class="svg-wrapper" ng-class="{{$scope.checkNeedsXSmall() ? \'svg-wrapper--logo-x-small\' : \'svg-wrapper--logo\'}}" ng-include="getTemplateUrl()"></div>'}}])}),define("header/directives/rn_star",["module","angular_helper","common/angular/services/viewport"],function(e,n){var r=n.createModule(arguments);return r.directive("rnStar",["$window","Viewport",function(e,n){return{restrict:"A",replace:!0,link:function(e){function r(){e.useSmall=!n.is("smallplus")}e.$on("$destroy",n.$watch("breakpoint",r)),r(),e.getTemplateUrl=function(){return e.useSmall?"header/star_small.html":"header/star_big.html"}},template:'<div class="svg-wrapper svg-wrapper--star" ng-include="getTemplateUrl()"></div>'}}])}),define("header/directives/rn_notification",["module","angular_helper"],function(e,n){var r=n.createModule(arguments);return r.directive("rnNotification",["$window",function(e){return{restrict:"A",link:function(n,r){r.on("click",function(n){if(!e.jQuery(n.target).is("a[href]")){var r=e.jQuery(this).find(".notice_button")[0];if(r)try{r.click()}catch(n){}}})}}}])}),define("common/angular/services/player_core_adapter",["module","angular_helper"],function(e,n){var r=n.createModule(arguments);return r.service("PlayerCoreAdapter",["$rootScope","$q","$window",function(e,n,r){function t(e){u?u[e].apply(u,c.call(arguments,1)):a=a.then(function(){u[e].apply(u,c.call(arguments,1))})}var o=this,i=n.defer(),a=i.promise,u=null,s=!0;r.Reverb.playerReady(function(){u=PlayerCore.getInstance(),i.resolve()});var c=[].slice;this.playSongNow=function(e,n,t){r.playSongNow(e,n,t)},this.buffered=0,this.played=0,this.position=0,this.duration=0,this.getCurrentSong=function(){return u?u.getCurrentSong():null},this.isPlaying=function(){return u&&u.isPlaying()},this.play=function(){t("play")},this.pause=function(){t("pause")},this.previous=function(){t("previous")},this.next=function(){t("next")},this.setPosition=function(e){t("setPosition",e)},this.enablePlayerCoreEventListeners=function(){s=!0},this.disablePlayerCoreEventListeners=function(){s=!1},this.getPlayer=function(){return i.promise.then(function(){return u._Player})};var l=function(){s&&e.$evalAsync(angular.noop)},d=function(n,r){s&&e.$evalAsync(function(){o.buffered=r})},f=function(n,r,t,i){s&&e.$evalAsync(function(){o.played=r,o.position=t,o.duration=i})},p=function(){s&&e.$evalAsync(angular.noop)};a=a.then(function(){u.bind({"player_core:song_changed":l,"player_core:update_max_progress":d,"player_core:song_progress":f,"player_core:playlist_reset":p}),e.$on("$destroy",function(){u.unbind({"player_core:song_changed":l,"player_core:update_max_progress":d,"player_core:song_progress":f,"player_core:playlist_reset":p})})})}]),r}),define("header/directives/left_menu_trigger",["module","angular_helper","common/angular/services/player_core_adapter"],function(e,n){var r=n.createModule(arguments);return r.directive("rnLeftMenuTrigger",["$window","PlayerCoreAdapter",function(e,n){return{restrict:"A",replace:!0,templateUrl:"header/left_menu_trigger.html",link:function(e){e.current_song=n.getCurrentSong(),e.$watch(function(){return n.getCurrentSong()},function(n){e.current_song=n},!0)}}}])}),define("header/directives/search_box",["module","angular_helper","common/angular/services/safe_apply"],function(e,n){var r=n.createModule(arguments);return r.directive("rnSearchBox",["$timeout","SafeApply",function(e,n){return{restrict:"A",scope:{hideOnBlur:"@"},templateUrl:"header/search/search_box.html",link:function(r,t){r.hideResults=!1,t.find("input").blur(function(){e(function(){r.showResults=!1},200,!0)}),t.find("input").focus(function(){n(function(){r.showResults=!0})})}}}])}),define("header/directives/search_results",["module","angular_helper","common/angular/directives/bind_html_compile"],function(e,n){var r=n.createModule(arguments);return r.directive("rnSearchResults",["$http","$templateCache","$compile","$location","SearchService",function(e,n,r,t,o){return{restrict:"A",replace:!0,scope:{searchResults:"=rnSearchResults"},link:function(i,a){i.displayOrder=function(){return o.DISPLAY_ORDER},i.$watch(function(){return o.hasResults()},function(e){i.hasResults=e}),i.fullSearchUrl=function(){return o.getSearchURL(o.getQuery(),!0)},i.fullSearch=function(){i.$parent.setDrawer&&i.$parent.setDrawer("closed"),t.url(i.fullSearchUrl())},e.get("header/search/results.html",{cache:n}).success(function(e){a.html(r(e)(i))})}}}])}),define("common/angular/services/modernizr",["module","angular_helper"],function(e,n){var r=n.createModule(arguments);return r.factory("Modernizr",["$window",function(e){return e.Modernizr}]),r}),define("header/directives/rn_modernizr",["module","angular_helper","common/angular/services/modernizr"],function(e,n){var r=n.createModule(arguments);return r.directive("rnModernizr",["$window","Modernizr",function(e,n){return{restrict:"A",link:function(r,t,o){o.rnModernizr&&angular.forEach(o.rnModernizr.split(","),function(r){if(r=e.jQuery.trim(r)){var o=n[r];angular.isDefined(o)&&t.addClass(o?r:"no-"+r)}})}}}]),r}),define("header/directives/quick_search_auto_focus",["module","angular_helper"],function(e,n){var r=n.createModule(arguments);return r.directive("rnQuickSearchAutoFocus",["$timeout",function(e){return{restrict:"A",require:"rnDropdown",link:function(n,r,t,o){function i(n){if(e.cancel(a),n){var t=r.find("input[type=text]:visible").first();t.length>0?t.focus():a=e(angular.bind(i,i,n),25,!1)}}var a;n.$watch(o.isOpen,i)}}}])}),function(e,n){"object"==typeof exports?module.exports=n():"function"==typeof define&&define.amd?define("vendor/spin",n):e.Spinner=n()}(this,function(){function e(e,n){var r,t=document.createElement(e||"div");for(r in n)t[r]=n[r];return t}function n(e){for(var n=1,r=arguments.length;r>n;n++)e.appendChild(arguments[n]);return e}function r(e,n,r,t){var o=["opacity",n,~~(100*e),r,t].join("-"),i=.01+r/t*100,a=Math.max(1-(1-e)/n*(100-i),e),u=c.substring(0,c.indexOf("Animation")).toLowerCase(),s=u&&"-"+u+"-"||"";return d[o]||(f.insertRule("@"+s+"keyframes "+o+"{0%{opacity:"+a+"}"+i+"%{opacity:"+e+"}"+(i+.01)+"%{opacity:1}"+(i+n)%100+"%{opacity:"+e+"}100%{opacity:"+a+"}}",f.cssRules.length),d[o]=1),o}function t(e,n){var r,t,o=e.style;for(n=n.charAt(0).toUpperCase()+n.slice(1),t=0;t<l.length;t++)if(r=l[t]+n,void 0!==o[r])return r;return void 0!==o[n]?n:void 0}function o(e,n){for(var r in n)e.style[t(e,r)||r]=n[r];return e}function i(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)void 0===e[t]&&(e[t]=r[t])}return e}function a(e,n){return"string"==typeof e?e:e[n%e.length]}function u(e){this.opts=i(e||{},u.defaults,p)}function s(){function r(n,r){return e("<"+n+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',r)}f.addRule(".spin-vml","behavior:url(#default#VML)"),u.prototype.lines=function(e,t){function i(){return o(r("group",{coordsize:l+" "+l,coordorigin:-c+" "+-c}),{width:l,height:l})}function u(e,u,s){n(f,n(o(i(),{rotation:360/t.lines*e+"deg",left:~~u}),n(o(r("roundrect",{arcsize:t.corners}),{width:c,height:t.width,left:t.radius,top:-t.width>>1,filter:s}),r("fill",{color:a(t.color,e),opacity:t.opacity}),r("stroke",{opacity:0}))))}var s,c=t.length+t.width,l=2*c,d=2*-(t.width+t.length)+"px",f=o(i(),{position:"absolute",top:d,left:d});if(t.shadow)for(s=1;s<=t.lines;s++)u(s,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(s=1;s<=t.lines;s++)u(s);return n(e,f)},u.prototype.opacity=function(e,n,r,t){var o=e.firstChild;t=t.shadow&&t.lines||0,o&&n+t<o.childNodes.length&&(o=o.childNodes[n+t],o=o&&o.firstChild,o=o&&o.firstChild,o&&(o.opacity=r))}}var c,l=["webkit","Moz","ms","O"],d={},f=function(){var r=e("style",{type:"text/css"});return n(document.getElementsByTagName("head")[0],r),r.sheet||r.styleSheet}(),p={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};u.defaults={},i(u.prototype,{spin:function(n){this.stop();{var r=this,t=r.opts,i=r.el=o(e(0,{className:t.className}),{position:t.position,width:0,zIndex:t.zIndex});t.radius+t.length+t.width}if(o(i,{left:t.left,top:t.top}),n&&n.insertBefore(i,n.firstChild||null),i.setAttribute("role","progressbar"),r.lines(i,r.opts),!c){var a,u=0,s=(t.lines-1)*(1-t.direction)/2,l=t.fps,d=l/t.speed,f=(1-t.opacity)/(d*t.trail/100),p=d/t.lines;!function g(){u++;for(var e=0;e<t.lines;e++)a=Math.max(1-(u+(t.lines-e)*p)%d*f,t.opacity),r.opacity(i,e*t.direction+s,a,t);r.timeout=r.el&&setTimeout(g,~~(1e3/l))}()}return r},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(t,i){function u(n,r){return o(e(),{position:"absolute",width:i.length+i.width+"px",height:i.width+"px",background:n,boxShadow:r,transformOrigin:"left",transform:"rotate("+~~(360/i.lines*l+i.rotate)+"deg) translate("+i.radius+"px,0)",borderRadius:(i.corners*i.width>>1)+"px"})}for(var s,l=0,d=(i.lines-1)*(1-i.direction)/2;l<i.lines;l++)s=o(e(),{position:"absolute",top:1+~(i.width/2)+"px",transform:i.hwaccel?"translate3d(0,0,0)":"",opacity:i.opacity,animation:c&&r(i.opacity,i.trail,d+l*i.direction,i.lines)+" "+1/i.speed+"s linear infinite"}),i.shadow&&n(s,o(u("#000","0 0 4px #000"),{top:"2px"})),n(t,n(s,u(a(i.color,l),"0 0 1px rgba(0,0,0,.1)")));return t},opacity:function(e,n,r){n<e.childNodes.length&&(e.childNodes[n].style.opacity=r)}});var g=o(e("group"),{behavior:"url(#default#VML)"});return!t(g,"transform")&&g.adj?s():c=t(g,"animation"),u}),define("common/angular/directives/spinner",["module","angular_helper","vendor/spin"],function(e,n,r){function t(e){var n={lines:13,length:5,width:2,radius:5,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%",delay:0};return{restrict:"A",scope:{showSpinner:"=",spinnerOptions:"@"},link:function(t,o,i){function a(n){e.cancel(l),l=null,n?u.delay?l=e(d,u.delay):d():c&&(c=!1,s.stop())}var u=angular.copy(n);t.spinnerOptions&&_.extend(u,angular.fromJson(t.spinnerOptions));var s=new r(u),c=!1;if(_.isUndefined(i.showSpinner))throw new Error("spinner attribute must be defined");var l=null;angular.element(s.el).addClass("js-show-spinner");var d=function(){c=!0,s.spin(),o.append(s.el)};t.$watch("showSpinner",a)}}}return r.$inject=[],n.createModule(arguments).directive("showSpinner",["$timeout",t])}),define("header/directives/all",["module","angular_helper","common/angular/directives/progress_slider","header/directives/menu_item","header/directives/rn_logo","header/directives/rn_star","header/directives/rn_notification","header/directives/left_menu_trigger","header/directives/search_box","header/directives/search_results","header/directives/rn_modernizr","header/directives/quick_search_auto_focus","common/angular/directives/spinner"],function(e,n){return n.createModule(arguments)}),define("common/filters",["angular"],function(){return angular.module("Common.Filters",[]).filter("truncate",function(){return function(e,n,r){return void 0===e||null===e?"":(isNaN(n)&&(n=10),void 0===r&&(r="..."),e.length<=n||e.length-r.length<=n?e:String(e).substring(0,n-r.length)+r)}}).filter("if",function(){return function(e,n,r){return e?n:r}}).filter("toArray",function(){return function(e){return e instanceof Object?_.map(e,function(e,n){return Object.defineProperty(e,"$key",{__proto__:null,value:n})}):e}}).filter("split",function(){return function(e,n){if(void 0===e)return!1;var n=n||",";return e.split(n)}}).filter("unsafe",["$sce",function(e){return function(n){return e.trustAsHtml(n)}}]).filter("percent",function(){return function(e,n){return Number.isNaN(e)?"0%":(n=angular.isNumber(n)?n:2,Math.round(e*Math.pow(10,n+2))/Math.pow(10,n)+"%")}}).filter("ordinal",function(){return function(e){var n=["th","st","nd","rd"],r=e%100;return e+=n[(r-20)%10]||n[r]||n[0]}}).filter("pagespeed",["$window",function(e){return function(n,r,t,o){if(!e.Reverb)return n;var i=e.Reverb.image.Quality.apply(n,o),a=e.Reverb.image.Blur.apply(i,10*parseInt(t,10));return e.Reverb.image.Resize.apply(a,r)}}]).filter("blur",["$window",function(e){return function(n,r){return e.Reverb?e.Reverb.image.Blur.apply(n,r):n}}]).filter("quality",["$window",function(e){return function(n,r){return e.Reverb?e.Reverb.image.Quality.apply(n,r):n}}]).filter("resize",["$window",function(e){return function(n,r){return e.Reverb?e.Reverb.image.Resize.apply(n,r):n}}]).filter("aspect",["$window",function(e){return function(n,r){return e.Reverb?e.Reverb.image.Aspect.apply(n,r):n}}]).filter("gray",["$window",function(e){return function(n,r){return e.Reverb?e.Reverb.image.Gray.apply(n,r):n}}]).filter("crop",["$window",function(e){return function(n,r){return e.Reverb?e.Reverb.image.Crop.apply(n,r):n}}]).filter("vendorTextFromUrl",function(){return function(e,n,r,t){n=n||"",r=r||"",t=t||"",e=e||"";var o;e=e.replace(/.*?:\/\//g,"");var i=/(?!:\/\/)^(?:www\.)?(amazon)\.(com|co\.uk)/,a=/^(?:geo\.)?(itunes)\.apple\.com/,u=/^[^. ]+\.bandcamp\.com/,s=/^(?:www\.)?(cdbaby)\.(?:com)/;return i.exec(e)?o="Amazon":a.exec(e)?o="iTunes":u.exec(e)?o="Bandcamp":s.exec(e)&&(o="CD Baby"),o?r+o+t:n}}).filter("svg",["$window","$sce","$log",function(e,n,r){return function(t){-1!==t.indexOf(".svg")&&(r.error("File Extension Error: "+t),t=t.split(".svg")[0]);var o=e.Reverb.staticCacheServer()+"/images/icons/svg/"+t+".svg";return n.trustAsResourceUrl(o)}}])}),define("common/angular/services/current_page_object",["module","angular_helper","jquery","angular"],function(e,n,r,t){var o=t.injector(["ng"]).get("$rootScope"),i=r("body"),a=function(){o.$evalAsync(function(){o.info=Reverb.current_page_object})};return a(),Reverb.Event.bind("user:changed",i,a),void 0===window._CurrentPageObject&&(window._CurrentPageObject=o),n.createModule(arguments).factory("CurrentPageObject",[function(){return n.scopeBinder(o,"info")}])}),define("common/angular/services/current_user",["module","angular_helper","jquery","angular"],function(e,n,r,t){var o=t.injector(["ng"]).get("$rootScope"),i=r("body"),a=function(){o.$evalAsync(function(){o.info=Reverb.current_user})};return a(),Reverb.Event.bind("user:changed",i,a),void 0===window._CurrentUser&&(window._CurrentUser=o),n.createModule(arguments).factory("CurrentUser",[function(){return n.scopeBinder(o,"info")}])}),define("restangular",["angular"],function(e){return e.module("restangular")}),define("common/angular/api/services/inflector",["module","angular_helper"],function(e,n){return n.createModule(arguments).factory("ReverbApiInflector",[function(){var e={},n={},r=function(e){return e[0].toLowerCase()+e.substr(1)},t=function(e){return e[0].toUpperCase()+e.substr(1)};return this.registerInflection=function(o,i){var a=r(o),u=t(o),s=r(i),c=t(i);e[a]=s,e[u]=c,n[s]=a,n[c]=u},this.singularize=function(e){return n[e]||this.registerInflection(e.replace(/s$/,""),e),n[e]},this.pluralize=function(n){return e[n]||this.registerInflection(n,n+"s"),e[n]},this}])}),define("common/angular/api/services/model_common",["module","angular_helper","common/angular/api/services/inflector"],function(e,n){var r=n.createModule(arguments).constant("API_MODEL_TYPES",["albums","artist","crowd_review_report","fan_reach_campaigns","fan_reaches","fan_reach_owners","label","location/countries","press","shows","social_networks","songs","stats","venue","videos"]).run(["ReverbApi","API_MODEL_TYPES","ReverbApiInflector",function(e,n,r){angular.forEach(n,function(n){e.extendCollection(n,function(e){return e.alpha_sort_params=function(){var e={};return e},e.model_type=n,e}),e.extendModel(n,function(e){return e.type=r.singularize(n),e.unique_id=function(){return r.singularize(n[0].toUpperCase()+n.substr(1))+"_"+e.id},e.displayName=function(){return e.name},e}),e.addElementTransformer(n,!0,function(e){return e}),e.addElementTransformer(n,!1,function(e){return delete e.parentResource,e}),e.addResponseInterceptor(function(e){return e})})}]);return r}),define("common/angular/api/services/page_object_common",["module","angular_helper"],function(e,n){var r=n.createModule(arguments).constant("API_PO_TYPES",["artist","label","fan","promoter","venue","musician"]).run(["ReverbApi","API_PO_TYPES",function(e,n){angular.forEach(n,function(n){e.extendModel(n,function(e){return e.type=n,e}),e.addElementTransformer(n,!0,function(e){return e.addRestangularMethod("search","get","search"),e}),e.addElementTransformer(n,!1,function(e){return e}),e.addResponseInterceptor(function(r,t,o,i){return new RegExp("^/api/"+n+"/search").test(i)?(extracted=_.map(r.results,function(r){return e.restangularizeElement("",r,n)}),extracted.pagination=r.pagination,extracted):r})})}]);return r}),define("common/angular/api/services/reverb_api",["module","angular_helper","restangular","common/angular/api/services/model_common","common/angular/api/services/page_object_common","common/angular/api/services/inflector"],function(e,n){return n.createModule(arguments).factory("ReverbApi",["Restangular","ReverbApiInflector",function(e,n){return e.withConfig(function(e){e.setBaseUrl("/api"),e.addFullRequestInterceptor(function(e,n,r,t,o,i){return["getList","get"].indexOf(n)>-1?(i=i||{},i.bust=(new Date).getTime(),{params:i}):void 0
}),e.addRequestInterceptor(function(e,r,t,o){var i=!1;if("remove"===r)return null;var a=void 0;try{a=angular.module("common/angular/api/models/"+t)}catch(u){}if(a){switch(r){case"put":i=new RegExp(t+"\\/([ABLMPV]\\d+-)?\\d*\\/?$").test(o);break;case"post":i=new RegExp(t+"\\/?$").test(o)}if(i)return wrappedElement={},wrappedElement[n.singularize(t)]=e,e=wrappedElement}return e}),e.addResponseInterceptor(function(e,n){var r;return"getList"===n&&e.results?(r=e.results,r.pagination=e.pagination):r=e,r})})}])}),define("common/angular/api/models/artists",["module","angular_helper","common/angular/api/services/reverb_api"],function(e,n){return n.createModule(arguments).run(["ReverbApi",function(e){e.addElementTransformer("artist",!1,function(e){return e.addRestangularMethod("getFans","get","fans"),e.addRestangularMethod("getFavorites","get","favorites"),e.addRestangularMethod("getStats","get","stats"),e.addRestangularMethod("getStatus","get","status"),e}),e.addResponseInterceptor(function(n,r,t,o){if(new RegExp("/api/artist/\\d+/(?:fans|favorites)").test(o)){var i=_.map(n.results,function(n){var r=n.obj;return r.became_fan_at=n.created_at,e.restangularizeElement("",r,r.type)});return i.pagination=n.pagination,i}return n})}]).factory("Artists",["ReverbApi",function(e){return e.service("artist")}])}),define("common/angular/api/models/fans",["module","angular_helper","common/angular/api/services/reverb_api"],function(e,n){return n.createModule(arguments).run(["ReverbApi",function(e){e.addElementTransformer("fan",!1,function(e){return e})}]).factory("Fans",["ReverbApi",function(e){return e.service("fan")}])}),define("common/angular/api/models/labels",["module","angular_helper","common/angular/api/services/reverb_api"],function(e,n){return n.createModule(arguments).factory("Labels",["ReverbApi",function(e){return e.service("label")}])}),define("common/angular/api/models/musicians",["module","angular_helper","common/angular/api/services/reverb_api"],function(e,n){return n.createModule(arguments).factory("Musicians",["ReverbApi",function(e){return e.service("musician")}])}),define("common/angular/api/models/promoters",["module","angular_helper","common/angular/api/services/reverb_api"],function(e,n){return n.createModule(arguments).factory("Promoters",["ReverbApi",function(e){return e.service("promoter")}])}),define("common/angular/api/models/venues",["module","angular_helper","common/angular/api/services/reverb_api"],function(e,n){return n.createModule(arguments).run(["ReverbApi",function(e){e.addElementTransformer("venue",!1,function(e){return e})}]).factory("Venues",["ReverbApi",function(e){return e.service("venue")}])}),define("common/angular/api/models/writers",["module","angular_helper","common/angular/api/services/reverb_api"],function(e,n){return n.createModule(arguments).factory("Writers",["ReverbApi",function(e){return e.service("writer")}])}),define("common/angular/api/models/page_objects",["module","angular_helper","common/angular/api/models/artists","common/angular/api/models/fans","common/angular/api/models/labels","common/angular/api/models/musicians","common/angular/api/models/promoters","common/angular/api/models/venues","common/angular/api/models/writers"],function(e,n){return n.createModule(arguments).factory("PageObjects",["Artists","Fans","Labels","Musicians","Promoters","Venues","Writers",function(e,n,r,t,o,i,a){return{forType:function(u){switch(u=u.toLowerCase()){case"artist":return e;case"fan":return n;case"label":return r;case"musician":return t;case"promoter":return o;case"venue":return i;case"writer":return a}return null}}}])}),define("header/controllers/header",["module","angular_helper","common/angular/services/viewport","common/angular/services/player_core_adapter","common/filters","common/angular/services/current_page_object","common/angular/services/current_user","common/angular/api/models/page_objects"],function(e,n){var r=n.createModule(arguments,"ngTouch"),t=["$scope","$log","$location","$window","$filter","$http","Viewport","Notifications","PlayerCoreAdapter","SearchService","CurrentPageObject","CurrentUser","PageObjects","Config",function(e,n,r,t,o,i,a,u,s,c,l,d,f,p){function g(e,n){var r=e.length-n.length;return r>=0&&e.indexOf(n,r)===r}function m(e,n){return 0===e.lastIndexOf(n,0)}var h=function(){var n=$j(document.body),r=a.is("large")||n.hasClass("ie8")||!a.is("medium")&&n.hasClass("not-redaptive-page");e.viewset=r?"desktop":"mobile"};e.isXLarge=function(){return a.is("xlarge")},e.Modernizr=t.Modernizr,e.$on("reverb:loading:show",function(){e.navigating=!0}),e.$on("reverb:loading:hide",function(){e.navigating=!1}),e.$on("$destroy",a.$watch("breakpoint",h)),e.$watch(function(){return angular.element(document.body).attr("class")},h),e.$on("$destroy",a.$watch("orientation",function(n){e.orientation=n})),e.orientation=a.orientation,e.current_song=s.getCurrentSong(),e.$watch(function(){return s.getCurrentSong()},function(n){e.current_song=n},!0),e.$watch(function(){return r.path()},function(){e.drawer="closed"}),e.$watch(function(){return c.getResults()},function(n){e.results=n}),e.$watch(function(){return c.getQuery()},function(n){e.query=n}),e.$watch(function(){return c.hasResults()},function(n){e.hasSearchResults=n});var v=function(){e.messages=[],e.unread_message_count=0,e.unseen_message_count=0;var n=f.forType(e.reverbUser.type);n&&n.one(e.reverbUser.id).all("messages").getList({per_page:3}).then(function(n){e.messages=_.toArray(n),e.unread_message_count=n.pagination.unread_count,e.unseen_message_count=n.pagination.total_new_message_count})},b=function(){u.get().then(function(n){e.notifications=n.data})};d(e,"reverbUser"),l(e,"reverbPageObject"),e.$watch("reverbUser",function(){e.reverbUser&&e.reverbUser.logged_in?(v(),e.allMessagesUrl="/control_room/"+e.reverbUser.type.toLowerCase()+"/"+e.reverbUser.id+"/messages",b(),e.allNotificationsUrl="/control_room/"+e.reverbUser.type.toLowerCase()+"/"+e.reverbUser.id+"/notices"):(e.allMessagesUrl="javascript:void(0);",e.allNotificationsUrl="javascript:void(0);")},!0),e.$watch("reverbPageObject.id_unique",function(n){if(n){var r=n.split("_"),t=r[0].toLowerCase(),o=r[1];i.get(["/api",t,o].join("/")).then(function(n){angular.extend(e.reverbPageObject,{data:n.data})})}}),e.resetViewedMessages=function(n){if(n){var r=f.forType(e.reverbPageObject.page_object_type);r&&r.one(e.reverbPageObject.id).all("reset_new_message_count").post({}).then(function(){}),e.unseen_message_count=0}else v()},e.resetViewedNotifications=function(n){n?(u.resetViewed(),e.notifications.num_new_notices=0):b()},e.urlForMessage=function(n){return"/control_room/"+e.reverbUser.type.toLowerCase()+"/"+e.reverbUser.id+"/messages/"+n.id},e.$watch("drawer",function(e,n){c.clear(),"right"==e?u.resetViewed():"right"!=e&&"right"==n&&b(),"closed"==e?jQuery("html").removeClass("showing-sidebar").removeClass("showing-sidebar--left").removeClass("showing-sidebar--right").removeClass("showing-sidebar--player"):jQuery("html").addClass("showing-sidebar").addClass("showing-sidebar--"+e)});var w=function(e){var n=angular.copy(e),r=n.user_menu,t=n.more_menu,o=n.nav_menu;if(r&&r){var i={display:'<span class="image-wrap image-wrap--large"><img width="67" ng-src="{{reverbUser.getThumbnailSrc()}}" err-src="{{reverbUser.getBlankThumbnailSrc()}}"/></span><span class="ellipsis ellipsis--inline middle percent-70 text-white bold pl2">{{ reverbUser.name }}</span>',type:"submenu",user_menu_item:!0,submenu:[]},a=_.findWhere(r.sections,{id:"profile"}),u=_.findWhere(r.sections,{id:"user_actions"}),s=_.findWhere(r.sections,{id:"switch_user"}),c=_.findWhere(r.sections,{id:"logout"});o.unshift(i);var l=function(e){var n=[];return e&&e.items&&(n=n.concat(_.map(e.items,function(e){var n={id:e.id,title:e.name,type:"link",url:e.url,js:e.js};return n}))),n};if(t&&o.push({id:"more",type:"submenu",title:"More",submenu:t}),i.submenu=i.submenu.concat(l(a)),i.submenu=i.submenu.concat(l(u)),s&&r.other_page_objects&&r.other_page_objects.length){var e={id:"switch_account",type:"submenu",title:"Use ReverbNation As"};i.submenu.push(e),e.submenu=_.map(r.other_page_objects.slice(0,4),function(e){return{id:"switch_account",type:"link",po:e,display:"<span class='left percent-70 ellipsis'>{{menu_item.po.name}}</span><span class='right switch-account-type'>"+e.get_type+"</span><div class='clearfix'></div>",url:"/user/switch_account_to/"+e.id_unique}}),e.submenu.unshift({type:"link",display:"<span class='left bold text-white pointer'>{{reverbUser.name}}</span><span class='right bold text-white switch-account-type'>{{reverbUser.type}}</span><div class='clearfix'></div>","class":"no-link"}),r.other_page_objects.length>4&&e.submenu.push({id:"more_accounts",type:"link",title:"More...",js:'modal_open("/c/user/switch_account_modal");'})}i.submenu=i.submenu.concat(l(c))}if(o){n.nav_menu=o=_.reject(o,function(e){return"search"==e.id||"star"==e.id||0==e.adaptive});var d=_.findWhere(n.nav_menu,{id:"tools"});d&&(d.submenu=_.reject(d.submenu,function(e){return 0==e.adaptive}))}return n},y=function(e){return e},$=function(e){return void 0===_.findWhere(e.nav_menu,{id:"search"})};e.$on("reverb:menu:update",function(n,r,t){e.menu=t,e.showMagnifier=$(t),e.desktop_menu=y(t),e.mobile_menu=w(t)}),e.drawer="closed",e.toggleDrawer=function(n){var r=e.drawer==n?"closed":n;e.setDrawer(r)},e.setDrawer=function(n){e.drawer=n},e.eval=function(e){jQuery.globalEval(e)},e.signupTracking=function(e){Reverb.Mixpanel.trackEvent("HeaderClick.join"),Reverb.Navigate.update_signup_source(e.target)},e.menuClick=function(){e.drawer="closed"},e.navigateTo=function(e,n){void 0===n&&(n=""),""==n?Reverb.Navigate.go_to_page_url(e):window.open(e,n)},e.classNamify=function(e){name_array=e.split(" "),final_name="";var n;for(n=0;n<name_array.length;n++)null!=name_array[n].match("^[a-zA-Z]+$")&&(final_name+="-"+name_array[n].toLowerCase());return final_name};var R=function(e){return _.find(e,function(e){if(e.url){if(e.url+(!g(e.url,"/")&&g(r.path(),"/")?"/":"")==r.path())return!0;if(e.additional_urls)for(var n=0;n<e.additional_urls.length;n++){var t=e.additional_urls[n];if(e.url+(g(e.url,"/")||m(t,"/")?"":"/")+t==r.path())return!0}}return!1})},M=function(n){var r=R(n);if(r)return r;for(var t=0;t<e.desktop_menu.nav_menu.length;t++)if(r=R(e.desktop_menu.nav_menu[t].submenu))return e.desktop_menu.nav_menu[t];return null},S=function(n){if(n)e.active_tab_id=n,p.active_menu_id=null;else if(e.desktop_menu&&e.desktop_menu.nav_menu){var r=M(e.desktop_menu.nav_menu);e.active_tab_id=r?r.id:null,p.active_menu_id=null}};S(p.active_menu_id),e.$watch("desktop_menu",function(){S(p.active_menu_id)}),Reverb.Event.bind("menu:set_active",jQuery("body"),function(e,n){S(n)}),e.isMenuActive=function(n){return null!=e.active_tab_id&&e.active_tab_id==n?!0:!1}}];return r.controller("HeaderCtrl",t),r}),define("header/controllers/left_drawer",["module","angular_helper"],function(e,n){var r=n.createModule(arguments),t=["$scope",function(e){function n(n){e.activeSubmenus=[],n&&n.nav_menu&&(e.activeSubmenus=[n.nav_menu])}e.$watch(function(){return e.$parent.mobile_menu},n),n(e.$parent.mobile_menu),e.$watch(function(){return e.$parent.drawer},function(r){"closed"==r&&n(e.$parent.mobile_menu)})}];return r.controller("LeftDrawerCtrl",t),r}),define("header/controllers/music_player",["module","angular_helper","common/angular/services/viewport","common/angular/services/player_core_adapter","common/angular/services/safe_apply"],function(e,n){var r=n.createModule(arguments,"ngSanitize","ngTouch"),t=["$http","$scope","$log","$window","PlayerCoreAdapter","Viewport","$filter",function(e,n,r,t,o,i,a){n.progress={actual:0,desired:0,buffered:0},n.currentSong=function(){return o.getCurrentSong()},n.defaultImage=Reverb.staticCacheServer()+"/images/v3/standard_resources/default_images/artist_big_thumb.png";var u=a("resize"),s=function(e){return e&&i.is("medium")&&(e=u(e,!1)),e},c=function(e){n.backgroundImage=e?s(e.image_large||e.image)||n.defaultImage:n.defaultImage};n.$on("$destroy",i.$watch("orientation",function(e){n.orientation=e})),n.orientation=i.orientation,n.$watch(function(){return o.getCurrentSong()},c,!0),n.$on("$destroy",i.$watch("breakpoint",function(){c(o.getCurrentSong())})),n.currentArtist=function(){var e=this.currentSong();return e?e.artist:"Nothing Playing"},n.currentTitle=function(){var e=this.currentSong();return e?e.title:"Nothing Playing"},n.play=function(){o.play()},n.pause=function(){o.pause()},n.previous=function(){o.previous()},n.next=function(){o.next()},n.$watch(function(){return o.isPlaying()},function(e){n.playing=e}),n.$watch(function(){return o.getCurrentSong()},function(){n.progress.buffered=n.progress.actual=n.progress.desired=0}),n.$watch(function(){return o.buffered},function(e){n.progress.buffered=e}),n.$watch(function(){return o.played},function(e){n.progress.actual=e}),n.$watch("progress.desired",function(e,n){Math.abs(e-n)>=.1&&o.setPosition(e)})}];return r.controller("MusicPlayerCtrl",t),r}),define("header/controllers/quick_search",["module","angular_helper"],function(e,n){var r=n.createModule(arguments),t=["$scope","$log","$http","$location","SearchService",function(e,n,r,t,o){e.searching=!1,e.results=null,e.doFullSearch=function(){o.clear(),o.query=e.query,t.url(o.getSearchURL(o.getQuery(),!0))},e.$watch(function(){return o.isSearching()},function(n){e.searching=n}),e.$watch(function(){return o.getResults()},function(n){e.results=n}),e.$watch("query",_.debounce(function(e,n){e!==n&&e!=o.getQuery()&&o.search(e)},1e3))}];return r.controller("QuickSearchCtrl",t),r}),define("header/controllers/all",["module","angular_helper","header/controllers/header","header/controllers/left_drawer","header/controllers/music_player","header/controllers/quick_search"],function(e,n){return n.createModule(arguments)}),define("header/services/notifications",["module","angular_helper"],function(e,n){function r(e,n){var r={};this.get=function(){var t=Reverb.current_user.id_unique();return t?(r[t]||(r[t]=e.get("/api/"+Reverb.current_user.type.toLowerCase()+"/"+Reverb.current_user.id+"/notices")),r[t]):n.reject("Not logged in")},this.resetViewed=function(){var t=Reverb.current_user.id_unique();return t?(delete r[t],e.post("/api/"+Reverb.current_user.type.toLowerCase()+"/"+Reverb.current_user.id+"/reset_new_notice_count")):n.reject("Not logged in")}}return n.createModule(arguments).service("Notifications",["$http","$q",r])}),define("header/services/search",["module","angular_helper","common/angular/services/safe_apply"],function(e,n){function r(e,n){this.DISPLAY_ORDER=["feature","artist","venue","label","fan","musician"],this.getSearchURL=function(e,n){return"/main/search?"+(n?"":"format=json&")+"q="+encodeURIComponent(e)},this.clear=function(){var e=this;e.results=null,e.query=null,e.searching=!1,e.canceler&&e.canceler.resolve()},this.getResults=function(){return this.results},this.getQuery=function(){return this.query},this.hasResults=function(){var e=this.results&&_.reduce(_.values(this.results),function(e,n){return e+n.length},0);return e>0},this.isSearching=function(){return this.searching},this.search=function(r){var t=this;this.clear(),r&&r.trim().length>0&&(this.query=r,this.searching=!0,this.canceler=n.defer(),e.get(this.getSearchURL(r),{timeout:this.canceler.promise}).then(function(e){t.results=e.data?_.pick(e.data,t.DISPLAY_ORDER):e.data,t.searching=!1,delete t.canceler},function(){t.results={},t.searching=!1,delete t.canceler}))}}return n.createModule(arguments).service("SearchService",["$http","$q",r])}),define("header/services/all",["module","angular_helper","header/services/notifications","header/services/search"],function(e,n){return n.createModule(arguments)}),define("header/app",["module","angular_helper","common/angular/main_site_essential","common/angular/components/dropdown","common/angular/directives/err_src","common/angular/directives/event_listener","common/angular/directives/history_manager","common/angular/services/safe_apply","common/angular/config/config","common/angular/filters/capitalize","header/filters/all","header/directives/all","header/controllers/all","header/services/all"],function(e,n){return n.createModule(arguments,"ngAnimate","Header.Templates")}),define("header/bootstrap",["module","angular_helper","header/app"],function(e,n){return n.configBootstrapper(arguments)}),define("modules/header",["header/bootstrap"],function(e){return e});