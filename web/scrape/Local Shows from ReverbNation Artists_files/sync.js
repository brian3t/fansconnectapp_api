define("angular_helper",["angular"],function(){var e=Object.prototype.toString,n=function(n){return"[object Arguments]"===e.apply(n)||null!==n&&void 0!==n&&!!n.callee},t=function(n){return"[object Array]"===e.apply(n)},o=function(e){return"string"==typeof e},c=function(e){if(n(e)||t(e))return c.apply(null,e);if(e&&e.id)return e.id;throw"Unable to extract AngularJS module name from RequireJS module: "+e},r=function(){var e=[];return angular.forEach(arguments,function(c){n(c)||t(c)?e.push.apply(e,r.apply(null,c)):o(c)?e.push(c):c&&c.name&&t(c.requires)&&e.push(c.name)}),e},i=function(){var e=c(arguments),n=r.apply(null,arguments);return angular.module(e,n)},s=function(){var e=arguments;return function(n,t){var o=i(e);o.config(["ConfigProvider",function(e){e.setConfig(t)}]),angular.bootstrap(n,[o.name],{strictDi:!0})}},a=function(e,n){function t(t,o){var c=function(e){t.$evalAsync(function(){t[o]=angular.copy(e,t[o])})};t.$on("$destroy",e.$watch(n,c,!0)),c(e.$eval(n))}return t};return{configBootstrapper:s,createModule:i,scopeBinder:a}}),define("common/angular/services/current_page_object",["module","angular_helper","jquery","angular"],function(e,n,t,o){var c=o.injector(["ng"]).get("$rootScope"),r=t("body"),i=function(){c.$evalAsync(function(){c.info=Reverb.current_page_object})};return i(),Reverb.Event.bind("user:changed",r,i),void 0===window._CurrentPageObject&&(window._CurrentPageObject=c),n.createModule(arguments).factory("CurrentPageObject",[function(){return n.scopeBinder(c,"info")}])}),define("common/angular/services/current_user",["module","angular_helper","jquery","angular"],function(e,n,t,o){var c=o.injector(["ng"]).get("$rootScope"),r=t("body"),i=function(){c.$evalAsync(function(){c.info=Reverb.current_user})};return i(),Reverb.Event.bind("user:changed",r,i),void 0===window._CurrentUser&&(window._CurrentUser=c),n.createModule(arguments).factory("CurrentUser",[function(){return n.scopeBinder(c,"info")}])}),define("common/lib/sync",["jquery","angular","common/angular/services/current_page_object","common/angular/services/current_user"],function(e,n,t,o){var c=function(n){var t=n.split("_"),o=t[0].toLowerCase(),c=t[1],r=["/api",o,c,"social_networks"].join("/"),i=["/api",o,c,"social_networks_settings"].join("/"),s=["/api",o,c,"social_networks_status"].join("/");this.id_unique=n;var a=function(e){e.id_unique=n,Reverb.Event.trigger("socialsync:update",e)},u=function(e){e.id_unique=n,Reverb.Event.trigger("socialsync:modified",e)},l=function(e){e.id_unique=n,Reverb.Event.trigger("socialsync:settings",e)},p=function(e){e.id_unique=n,Reverb.Event.trigger("socialsync:status",e)};this.refresh=function(){var n=e.getJSON(r,function(e){_.each(Reverb.config.social_networks,function(n){var t=_.indexBy(e.results,"network")[n];a(t?t:{network:n,connected:!1})})}),t=e.getJSON(i,function(e){l(e)});return n.then(function(e){return t.then(function(n){return{networks:e,settings:n}}).promise()})},this.sync=function(n){e.ajax({url:r+"/"+n.network,type:"POST",data:JSON.stringify({social_network:n}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.success&&u(e.social_network)}})},this.desync=function(n,t){e.ajax({url:r+"/"+n,type:"DELETE",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.success&&u({network:n,connected:!1,source:t.source})}})},this.saveSetting=function(n,t,o){var c={};c[n]=t,e.ajax({url:i,type:"POST",data:JSON.stringify({settings:c}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){l(e),void 0!==o&&o()}})},this.status=function(n){e.ajax({url:s,type:"GET",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){p(e),void 0!==n&&n()}})}};if(void 0===window._SocialSync){var r=n.injector(["ng",o.name,t.name]),i=r.get("$rootScope"),s=r.get("$q").defer(),a=r.get("CurrentUser"),u=r.get("CurrentPageObject"),l=e("body"),p=function(){n.copy({},i.service.networks),n.copy({},i.service.settings);var e=s;s=r.get("$q").defer(),e.reject(),i.syncClient=null};i.service={networks:{},settings:{},status:{}},Reverb.Event.bind("socialsync:modified_as_string",l,function(e,n){Reverb.Event.trigger("socialsync:modified",JSON.parse(n))}),Reverb.Event.bind("socialsync:modified",l,function(n,t){t.connected?e("a[data-social-connect="+t.network+"]").attr("data-social-connected","true"):e("a[data-social-connect="+t.network+"]").attr("data-social-connected",null),Reverb.Event.trigger("socialsync:update",t)}),Reverb.Event.bind("socialsync:update",l,function(e,n){i.$evalAsync(function(){"string"==typeof n&&(n=JSON.parse(n)),n.id_unique===i.syncClient.id_unique&&(i.service.networks[n.network]=n,Reverb.Event.trigger("socialsync:update_finished"))})}),Reverb.Event.bind("socialsync:settings",l,function(e,n){i.$evalAsync(function(){n.id_unique==i.syncClient.id_unique&&(i.service.settings=n)})}),Reverb.Event.bind("socialsync:status",l,function(e,n){i.$evalAsync(function(){n.id_unique==i.syncClient.id_unique&&(i.service.status=n)})}),Reverb.Event.bind("socialsync:sync",l,function(e,n){i.$evalAsync(function(){n.id_unique==i.syncClient.id_unique&&i.syncClient.sync(n)})});var f=function(e){var n=e[0],t=e[1],o=null;n&&Reverb.current_page_object.current_user_can_maintain?o=n:t&&(o=t),o?i.syncClient&&i.syncClient.id_unique==o||(i.syncClient=new c(o),i.syncClient.refresh(),s.resolve(i.syncClient)):p()};a(i,"currentUser"),u(i,"currentPageObject"),i.$watchGroup(["currentPageObject.id_unique","currentUser.id_unique()"],f);var d=function(e,n,t){var o=[e];return(i.service.settings.auto_update||t)&&o.push(n),o},g=function(){var e=[];return _.keys(i.service.networks).each(function(n){i.service.networks[n].connected&&"fb_page"===n&&e.push("publish_page")}),e};i.service.connect=function(n,t){switch(t||(t={}),n){case"fb_connect":Reverb.Facebook.initialized().done(function(){new Reverb.FacebookPermissionsPrompt({features:["sync_personal"],message:t.message||"We require this permission in order to synchronize your Facebook account with your ReverbNation profile.",callbacks:{success:function(e){"connected"===e.status&&i.syncClient.sync({network:"fb_connect",access_token:e.authResponse.accessToken,access_token_app:Reverb.Facebook.get_init_params().appId,source:t.source})}}}).prompt()});break;case"fb_page":Reverb.Facebook.initialized().done(function(){new Reverb.FacebookPermissionsPrompt({features:d("sync_page","publish_page",t.forcePublish),message:t.message||"We require this permission in order to manage and access your Facebook Band Page.",callbacks:{success:function(n){if("connected"===n.status){var o={access_token:n.authResponse.accessToken,access_token_app:Reverb.Facebook.get_init_params().appId,source:t.source},c="/page_object/profile_status_choose_fb_page/"+i.syncClient.id_unique+"?"+e.param(o);modal_open_current(c)}}}}).prompt()});break;case"google-api":launch_external_popup("/c/oauth2/request_token/"+i.syncClient.id_unique+"?network=google&source="+t.source,"google_oauth_dialog",1e3,560);break;case"youtube":launch_external_popup("/c/oauth2/request_token/"+i.syncClient.id_unique+"?network=youtube&source="+t.source,"youtube_oauth_dialog",1e3,560);break;case"twitter":launch_external_popup("/c/oauth/request_token/"+i.syncClient.id_unique+"?network=twitter&source="+t.source,"twitter_oauth_dialog",1e3,560);break;case"instagram":launch_external_popup("/c/oauth/oauth2_authorize/"+i.syncClient.id_unique+"?network=instagram&source="+t.source,"instagram_oauth_dialog",1e3,560);break;default:throw"Unknown network: "+n}},i.service.disconnect=function(e,n){n||(n={}),"fb_connect"==e&&FB.logout(function(){}),i.syncClient.desync(e,n)},i.service.likeFbPage=function(e,n){i.syncClient.saveSetting("like_fb_page",e,n)},i.service.autoUpdate=function(e,n){var t={success:function(){i.syncClient.saveSetting("auto_update",e,n)},failure:function(){i.syncClient.refresh()}};if(e){var o=g();o.length>0?Reverb.Facebook.initialized().done(function(){new Reverb.FacebookPermissionsPrompt({features:o,message:"We require this permission in order to post to Facebook on your behalf.",callbacks:t}).prompt()}):t.success()}else t.success()},i.service.pullExternalStatus=function(e,n){i.syncClient.saveSetting("pull_external_status",e,n)},i.service.mostRecentStatus=function(e){s.promise.then(function(n){n.status(e)},function(){i.service.mostRecentStatus(e)})},i.service.autoPostCheckbox=function(n){var t=e(n);Reverb.Event.bind("socialsync:settings",t,function(e,n){t.prop("checked",n.auto_update).change()}),t.click(function(e){e.preventDefault(),i.service.autoUpdate(t.prop("checked"))})},i.service.isAutoPostNetwork=function(e){return-1!==["fb_connect","fb_page","twitter"].indexOf(e)},window._SocialSync=i}return window._SocialSync});