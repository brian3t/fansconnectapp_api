define("angular_helper",["angular"],function(){var e=Object.prototype.toString,t=function(t){return"[object Arguments]"===e.apply(t)||null!==t&&void 0!==t&&!!t.callee},n=function(t){return"[object Array]"===e.apply(t)},r=function(e){return"string"==typeof e},o=function(e){if(t(e)||n(e))return o.apply(null,e);if(e&&e.id)return e.id;throw"Unable to extract AngularJS module name from RequireJS module: "+e},a=function(){var e=[];return angular.forEach(arguments,function(o){t(o)||n(o)?e.push.apply(e,a.apply(null,o)):r(o)?e.push(o):o&&o.name&&n(o.requires)&&e.push(o.name)}),e},i=function(){var e=o(arguments),t=a.apply(null,arguments);return angular.module(e,t)},l=function(){var e=arguments;return function(t,n){var r=i(e);r.config(["ConfigProvider",function(e){e.setConfig(n)}]),angular.bootstrap(t,[r.name],{strictDi:!0})}},c=function(e,t){function n(n,r){var o=function(e){n.$evalAsync(function(){n[r]=angular.copy(e,n[r])})};n.$on("$destroy",e.$watch(t,o,!0)),o(e.$eval(t))}return n};return{configBootstrapper:l,createModule:i,scopeBinder:c}}),define("common/angular/services/log",["module","angular_helper"],function(e,t){return t.createModule(arguments).factory("$log",["$window",function(e){return e.Reverb}])}),define("common/angular/services/exception_handler",["module","angular_helper","common/angular/services/log"],function(e,t){return t.createModule(arguments).factory("$exceptionHandler",["$log","$window",function(e,t){return function(n,r){e.error(n.stack,r),t.Hoptoad&&t.Hoptoad.notify(n)}}])}),define("common/angular/config/csrf_protection",["module","angular_helper"],function(e,t){var n=t.createModule(arguments);return n.factory("CSRFToken",[function(){return{get:function(){var e=angular.element("[name=csrf-token]");return e.length<1?null:e[0].content}}}]),n}),define("common/angular/config/location_provider",["module","angular_helper"],function(e,t){var n,r=parseInt((/android (\d+)/.exec(angular.lowercase((window.navigator||{}).userAgent))||[])[1],10),o=/Boxee/i.test((window.navigator||{}).userAgent);return n=!window.history||!window.history.pushState||4>r||o?!1:{enabled:!0,requireBase:!1,rewriteLinks:!0},Reverb.log("html5mode",n),t.createModule(arguments).value("$html5mode",n).config(["$locationProvider",function(e){e.html5Mode(n),e.hashPrefix("!")}]).run(["$window","$log","$rootScope","$rootElement","$location",function(e,t,n,r,o){n.$root._$location=o,e.rootScopes=e.rootScopes||[],e.rootScopes.push(n),r.on("$destroy",function(){t.debug("Destroying $rootScope:",n.$id),n.$destroy(),e.rootScopes.splice(e.rootScopes.indexOf(n),1)}),n.$on("$locationChangeStart",function(t,n,r,o,a){var i=[];angular.forEach(e.rootScopes,function(e){e._$perform_navigation?i.push(e):e.$broadcast("$globalLocationChangeStart",n,r,o,a)}),angular.forEach(i,function(e){e.$broadcast("$globalLocationChangeStart",n,r,o,a)})}),n.$on("$locationChangeSuccess",function(t,r,a){angular.forEach(e.rootScopes,function(e){e!==n&&r!==a&&e.$evalAsync(function(){e._$location.url(o.url())})})})}])}),define("common/angular/config/prevent_navigation",["module","angular_helper","common/angular/config/location_provider"],function(e,t){return t.createModule(arguments).run(["$rootElement","$html5mode",function(e,t){t&&e.on("click",function(e){e&&e.originalEvent&&(e.originalEvent.ngSuppressed=!0)})}])}),define("common/angular/config/sce_delegate_whitelist",["module","angular_helper"],function(e,t){return t.createModule(arguments).config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self",/^https?\:\/\/(?:[^\/]*\.)?edgecastcdn\.net\/.*/,/^https?\:\/\/(?:[^\/]*\.)?reverbnation\.com\/.*/,/^https?\:\/\/(?:[^\/]*\.)?soniclemur\.com\/.*/,/^https?\:\/\/(?:[^\/]*\.)?eartight\.com\/.*/,/^https?\:\/\/(?:[^\/]*\.)?tunehive\.com\/.*/,/^https?\:\/\/djj-tunehive-cdn\.ngrok\.io\/.*/])}])}),define("common/angular/main_site_essential",["module","angular_helper","common/angular/services/exception_handler","common/angular/services/log","common/angular/config/csrf_protection","common/angular/config/location_provider","common/angular/config/prevent_navigation","common/angular/config/sce_delegate_whitelist"],function(e,t){return t.createModule(arguments)}),define("common/angular/components/pagination",["module","angular_helper"],function(e,t){return t.createModule(arguments).factory("PaginationService",[function(){return{addPagination:function(e,t,n,r){var o=1,a=[];n=n||3,r=r||5,t.then?t.then(function(e){return a=e,e}):a=t,e.getTotalItems=function(){return a.length},e.getMaxSize=function(){return r},e.getPageSize=function(){return n},e.setPageSize=function(e){n=e},e.getNumberOfPages=function(){return Math.ceil(a.length/n)},e.getCurrentPage=function(){return Math.max(1,Math.min(e.getNumberOfPages(),o))},e.setCurrentPage=function(t){o=Math.max(1,Math.min(e.getNumberOfPages(),t))},e.getCurrentPageStart=function(){return(e.getCurrentPage()-1)*n},e.getCurrentPageEnd=function(){return Math.min(a.length,e.getCurrentPage()*n-1)},e.getPageNumberForItem=function(e){return Math.max(1,Math.ceil((a.indexOf(e)+1)/n))},e.disablePagination=function(){n=Number.MAX_VALUE}}}}]).filter("paginate",[function(){return function(e,t,n){return angular.isArray(e)?e.slice(t,n+1):[]}}]).run(["$templateCache",function(e){var t=["<div>",'<div ng-if="useFoundation == true">','<ul class="pagination">','<li ng-repeat="page in pages" ng-class="{current: page.active, unavailable: page.disabled, arrow: page.previous || page.next, \'n-of-n\': page.nOfN}">',"<a ng-if=\"!page.nOfN\" ng-click=\"selectPage(page.number)\" ng-class=\"{'qa-current-page': page.active, 'qa-previous-page': page.previous, 'qa-next-page': page.next, '{{'qa-page-' + page.text}}': page.text, 'qa-last-page': {{page.number === totalPages}} }\">{{page.text}}</a>",'<span ng-if="page.nOfN">{{page.text}}</span>',"</li>","</ul>","</div>",'<div class="pagination" ng-if="useFoundation != true">',"<ul>",'<li ng-repeat="page in pages" ng-class="{active: page.active, disabled: page.disabled}">','<a ng-click="selectPage(page.number)">{{page.text}}</a>',"</li>","</ul>","</div>","</div>"].join(""),n=['<div class="pager">',"<ul>",'<li ng-repeat="page in pages" ng-class="{disabled: page.disabled, previous: page.previous, next: page.next}">','<a ng-click="selectPage(page.number)">{{page.text}}</a>',"</li>","</ul>","</div>"].join("");e.put("template/pagination/pagination.html",t),e.put("template/pagination/pager.html",n)}]).controller("PaginationController",["$scope","$attrs","$parse","$interpolate",function(e,t,n,r){var o=this,a=t.numPages?n(t.numPages).assign:angular.noop;this.init=function(r){t.itemsPerPage?e.$parent.$watch(n(t.itemsPerPage),function(t){o.itemsPerPage=parseInt(t,10),e.totalPages=o.calculateTotalPages()}):this.itemsPerPage=r},this.noPrevious=function(){return 1===this.page},this.noNext=function(){return this.page===e.totalPages},this.isActive=function(e){return this.page===e},this.calculateTotalPages=function(){var t=this.itemsPerPage<1?1:Math.ceil(e.totalItems/this.itemsPerPage);return Math.max(t||0,1)},this.getAttributeValue=function(t,n,o){return angular.isDefined(t)?o?r(t)(e.$parent):e.$parent.$eval(t):n},this.render=function(){this.page=parseInt(e.page,10)||1,this.page>0&&this.page<=e.totalPages&&(e.pages=this.getPages(this.page,e.totalPages))},e.selectPage=function(t){!o.isActive(t)&&t>0&&t<=e.totalPages&&(e.page=t,e.onSelectPage({page:t}))},e.$watch("page",function(){o.render()}),e.$watch("totalItems",function(){e.totalPages=o.calculateTotalPages()}),e.$watch("totalPages",function(t){a(e.$parent,t),o.page>t?e.selectPage(t):o.render()})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function(e,t){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &",useFoundation:"="},controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(n,r,o,a){function i(e,t,n,r){return{number:e,text:t,active:n,disabled:r}}var l,c=a.getAttributeValue(o.boundaryLinks,t.boundaryLinks),u=a.getAttributeValue(o.directionLinks,t.directionLinks),s=a.getAttributeValue(o.firstText,t.firstText,!0),g=a.getAttributeValue(o.previousText,t.previousText,!0),f=a.getAttributeValue(o.nextText,t.nextText,!0),p=a.getAttributeValue(o.lastText,t.lastText,!0),d=a.getAttributeValue(o.rotate,t.rotate);a.init(t.itemsPerPage),o.maxSize&&n.$parent.$watch(e(o.maxSize),function(e){l=parseInt(e,10),a.render()}),a.getPages=function(e,t){var r=[],h=1,m=t,_=angular.isDefined(l)&&t>l;_&&(d?(h=Math.max(e-Math.floor(l/2),1),m=h+l-1,m>t&&(m=t,h=m-l+1)):(h=(Math.ceil(e/l)-1)*l+1,m=Math.min(h+l-1,t)));for(var v=h;m>=v;v++){var b=i(v,v,a.isActive(v),!1);r.push(b)}if(_&&!d){if(h>1){var y=i(h-1,"...",!1,!1);r.unshift(y)}if(t>m){var E=i(m+1,"...",!1,!1);r.push(E)}}if(n.$eval(o.useFoundation)){var P=i(e,e+" of "+t,!1,!1);P.nOfN=!0,r.unshift(P)}if(u){var O=i(e-1,g,!1,a.noPrevious());O.previous=!0,r.unshift(O);var C=i(e+1,f,!1,a.noNext());C.next=!0,r.push(C)}if(c){var R=i(1,s,!1,a.noPrevious());r.unshift(R);var A=i(t,p,!1,a.noNext());r.push(A)}return r}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"« Previous",nextText:"Next »",align:!0}).directive("pager",["pagerConfig",function(e){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &",useFoundation:"="},controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(t,n,r,o){function a(e,t,n,r,o){return{number:e,text:t,disabled:n,previous:c&&r,next:c&&o}}var i=o.getAttributeValue(r.previousText,e.previousText,!0),l=o.getAttributeValue(r.nextText,e.nextText,!0),c=o.getAttributeValue(r.align,e.align);o.init(e.itemsPerPage),o.getPages=function(e){return[a(e-1,i,o.noPrevious(),!0,!1),a(e+1,l,o.noNext(),!1,!0)]}}}}])}),define("common/angular/directives/err_src",["module","angular_helper"],function(e,t){return t.createModule(arguments).directive("errSrc",[function(){return{restrict:"A",link:function(e,t,n){t.bind("error",function(){t.attr("src")!=n.errSrc&&t.attr("src",n.errSrc)})}}}])}),define("common/angular/directives/event_listener",["module","angular_helper"],function(e,t){return t.createModule(arguments).directive("eventListener",["$window",function(e){return{restrict:"A",scope:{eventListener:"@"},link:function(t,n){function r(e,n){function r(e,r){t.$evalAsync(function(){t.$emit(n,e,r)})}var o=n.indexOf(":"),a=n.substring(o+1);e.bind(a,r),t.$on("$destroy",function(){e.unbind(n,r)})}var o=t.eventListener.replace(/\s/g,"").split(",");angular.forEach(o,function(o){var a=o.split(":");if(a.length<2)throw new Error("Invalid event specification: "+o);switch(a[0]){case"reverb":if(3!=a.length)throw new Error("Invalid Reverb.Event specification: "+o);n.addClass(a[1]+"_event_handler"),n.bind(a[1]+":"+a[2],function(e,n){t.$evalAsync(function(){t.$emit(o,e,n)})});break;case"window":r(jQuery(e),o);break;case"music_player":r(MusicPlayer.getInstance(),o);break;default:throw new Error("Invalid event specification: "+o)}})}}}])}),define("common/filters",["angular"],function(){return angular.module("Common.Filters",[]).filter("truncate",function(){return function(e,t,n){return void 0===e||null===e?"":(isNaN(t)&&(t=10),void 0===n&&(n="..."),e.length<=t||e.length-n.length<=t?e:String(e).substring(0,t-n.length)+n)}}).filter("if",function(){return function(e,t,n){return e?t:n}}).filter("toArray",function(){return function(e){return e instanceof Object?_.map(e,function(e,t){return Object.defineProperty(e,"$key",{__proto__:null,value:t})}):e}}).filter("split",function(){return function(e,t){if(void 0===e)return!1;var t=t||",";return e.split(t)}}).filter("unsafe",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("percent",function(){return function(e,t){return Number.isNaN(e)?"0%":(t=angular.isNumber(t)?t:2,Math.round(e*Math.pow(10,t+2))/Math.pow(10,t)+"%")}}).filter("ordinal",function(){return function(e){var t=["th","st","nd","rd"],n=e%100;return e+=t[(n-20)%10]||t[n]||t[0]}}).filter("pagespeed",["$window",function(e){return function(t,n,r,o){if(!e.Reverb)return t;var a=e.Reverb.image.Quality.apply(t,o),i=e.Reverb.image.Blur.apply(a,10*parseInt(r,10));return e.Reverb.image.Resize.apply(i,n)}}]).filter("blur",["$window",function(e){return function(t,n){return e.Reverb?e.Reverb.image.Blur.apply(t,n):t}}]).filter("quality",["$window",function(e){return function(t,n){return e.Reverb?e.Reverb.image.Quality.apply(t,n):t}}]).filter("resize",["$window",function(e){return function(t,n){return e.Reverb?e.Reverb.image.Resize.apply(t,n):t}}]).filter("aspect",["$window",function(e){return function(t,n){return e.Reverb?e.Reverb.image.Aspect.apply(t,n):t}}]).filter("gray",["$window",function(e){return function(t,n){return e.Reverb?e.Reverb.image.Gray.apply(t,n):t}}]).filter("crop",["$window",function(e){return function(t,n){return e.Reverb?e.Reverb.image.Crop.apply(t,n):t}}]).filter("vendorTextFromUrl",function(){return function(e,t,n,r){t=t||"",n=n||"",r=r||"",e=e||"";var o;e=e.replace(/.*?:\/\//g,"");var a=/(?!:\/\/)^(?:www\.)?(amazon)\.(com|co\.uk)/,i=/^(?:geo\.)?(itunes)\.apple\.com/,l=/^[^. ]+\.bandcamp\.com/,c=/^(?:www\.)?(cdbaby)\.(?:com)/;return a.exec(e)?o="Amazon":i.exec(e)?o="iTunes":l.exec(e)?o="Bandcamp":c.exec(e)&&(o="CD Baby"),o?n+o+r:t}}).filter("svg",["$window","$sce","$log",function(e,t,n){return function(r){-1!==r.indexOf(".svg")&&(n.error("File Extension Error: "+r),r=r.split(".svg")[0]);var o=e.Reverb.staticCacheServer()+"/images/icons/svg/"+r+".svg";return t.trustAsResourceUrl(o)}}])}),define("common/angular/config/config",["module","angular_helper"],function(e,t){return t.createModule(arguments).provider("Config",[function(){var e=function(t){return angular.forEach(arguments,function(n){n!==t&&angular.forEach(n,function(n,r){t[r]&&t[r].constructor&&t[r].constructor===Object?e(t[r],n):t[r]=n})}),t},t={};this.setConfig=function(n){t=e({},t,n)},this.$get=[function(){return t}]}])}),define("common/angular/config/disable_autoscroll",["module","angular_helper"],function(e,t){return t.createModule(arguments).config(["$anchorScrollProvider",function(e){e.disableAutoScrolling()}])}),define("common/angular/services/parse_url",["module","angular_helper"],function(e,t){var n=t.createModule(arguments);return n.factory("ParseURL",["$document",function(e){var t=e[0].createElement("a");return function(e){if(angular.isString(e)){var n=e.split("#!");return 1!=n.length&&(e=n[1]),t.href=e,{protocol:(t.protocol||"").split(":")[0],hostname:t.hostname,port:t.port,host:t.host,pathname:"/"==t.pathname[0]?t.pathname:"/"+t.pathname,search:t.search,hash:t.hash}}throw new Error("Invalid URL: "+e)}}]),n}),define("common/angular/config/query_param_skips_navigation",["module","angular_helper","common/angular/services/parse_url"],function(e,t){var n=t.createModule(arguments);return n.run(["$log","$rootScope","$location","ParseURL",function(e,t,n,r){var o=r(n.url()).pathname;t.$on("$globalLocationChangeStart",function(e,t){var n=r(t).pathname;o===n&&Reverb.Event.trigger("history:skip_navigation",t)})}]),n}),void 0===window.Reverb&&(window.Reverb={}),Reverb.LocalSceneHelper=function(){var e={GEO:"geo",GEO_COUNTRY:"country",GEO_STATE:"state",GEO_CITY:"city",GEO_ZIP:"postal_code",RANGE_TYPE:"range_type",RANGE_DATE:"range_date",PAGE:"page"},t={TODAY:"today",TOMORROW:"tomorrow",WEEKEND:"weekend",DATE:"date",FULL:"full"},n=function(){var n=function(e){return e&&"string"==typeof e&&e.length?e:void 0};this._params={geo:"local"},this.for_geo_location=function(e){return this.for_country(e.country).for_state(e.state).for_city(e.city).for_zip(e.postal_code||e.zip)},this.for_country=function(t){return this._params[e.GEO_COUNTRY]=n(t),this},this.for_state=function(t){return this._params[e.GEO_STATE]=n(t),this},this.for_city=function(t){return this._params[e.GEO_CITY]=n(t),this},this.for_zip=function(t){return this._params[e.GEO_ZIP]=t,this},this.for_range_type=function(t){return this._params[e.RANGE_TYPE]=t,this},this.for_date=function(n){var r=null;if(n instanceof Date){var o=n.getFullYear(),a=(1+n.getMonth()).toString();a=a.length>1?a:"0"+a;var i=n.getDate().toString();i=i.length>1?i:"0"+i,r=a+"/"+i+"/"+o}else"string"==typeof n&&(r=n);return this.for_range_type(t.DATE),this._params[e.RANGE_DATE]=r,this},this.for_page=function(t){return this._params[e.PAGE]=t,this},this.params=function(){return _.clone(this._params)},this.query=function(){return _.map(this._params,function(e,t){return void 0!==e?t+"="+e:""}).join("&")},this.url=function(){return"/main/local_scene?"+this.query()},this.go=function(){this._validate()&&Reverb.Navigate.go_to_page_url(this.url())},this._validate=function(){var t=this._params,n=!t[e.GEO_COUNTRY]&&!t[e.GEO_CITY]||t[e.GEO_COUNTRY]&&t[e.GEO_CITY];if(!n)try{throw"Invalid local scene state.  Country and City are both required if either is supplied.  You provided "+JSON.stringify(this._params)}catch(r){if("production"!=Reverb.config.env)throw r;Reverb.error(r),Reverb.ErrorNotifier&&Reverb.ErrorNotifier.notify(r)}return!0}},r={PARAM_KEYS:e,RANGE_TYPES:t};return _.each(["for_geo_location","for_country","for_state","for_city","for_zip","for_page","for_range_type","for_date"],function(e){r[e]=function(){var t=new n;return t[e].apply(t,arguments)}}),r}(),define("main/local_scene_helper",function(){}),void 0===window.Reverb&&(window.Reverb={}),Reverb.ChartHelper=function(){var e={GENRE:"genre",ARTIST:"artist_id",GEO_TYPE:"geo",GEO_COUNTRY:"country",GEO_STATE:"state",GEO_CITY:"city",GEO_ZIP:"postal_code",GEO_REGION:"region",PAGE:"page"},t={GLOBAL:"global",NATIONAL:"national",REGIONAL:"regional",LOCAL:"local"},n=function(){var n=function(e){return e&&"string"==typeof e&&e.length?e:void 0};this._params={},this.for_artist=function(t){return this._params[e.ARTIST]=t,this},this.global=function(){return this.for_geo_type(t.GLOBAL)},this.national=function(e){return this.for_geo_type(t.NATIONAL),e&&this.for_country(e),this},this.regional=function(e){return this.for_geo_type(t.REGIONAL),e&&this.for_region(e),this},this.local=function(){return this.for_geo_type(t.LOCAL)},this.for_geo_type=function(t){return this._params[e.GEO_TYPE]=t,this},this.for_geo_location=function(e){return this.for_country(e.country).for_state(e.state).for_city(e.city).for_zip(e.postal_code||e.zip).for_region(e.region)},this.for_country=function(t){return this._params[e.GEO_COUNTRY]=n(t),this},this.for_state=function(t){return this._params[e.GEO_STATE]=n(t),this},this.for_city=function(t){return this._params[e.GEO_CITY]=n(t),this},this.for_zip=function(t){return this._params[e.GEO_ZIP]=t,this},this.for_region=function(t){return this._params[e.GEO_REGION]=t,this},this.for_genre=function(t){return this._params[e.GENRE]=t,this},this.for_page=function(t){return this._params[e.PAGE]=t,this},this.params=function(){return _.clone(this._params)},this.query=function(){return _.map(this._params,function(e,t){return void 0!==e?t+"="+e:""}).join("&")},this.url=function(){return"/main/charts?"+this.query()},this.go=function(){this._validate()&&Reverb.Navigate.go_to_page_url(this.url())},this._validate=function(){var n=this._params,r=!this._params[e.GEO_TYPE]||n[e.GEO_TYPE]==t.GLOBAL||n[e.GEO_TYPE]==t.NATIONAL&&n[e.GEO_COUNTRY]||n[e.GEO_TYPE]==t.REGIONAL&&n[e.GEO_REGION]||n[e.GEO_TYPE]==t.LOCAL&&n[e.GEO_COUNTRY]&&n[e.GEO_CITY];if(!r)try{throw"Invalid chart state.  National charts require country, regional charts require region and local charts require both country and city.  You provided "+JSON.stringify(this._params)}catch(o){if("production"!=Reverb.config.env)throw o;Reverb.error(o),Reverb.ErrorNotifier&&Reverb.ErrorNotifier.notify(o)}return!0}},r={PARAM_KEYS:e,GEO_TYPES:t};return _.each(["for_artist","for_geo_type","for_geo_location","for_country","for_state","for_city","for_zip","for_region","for_genre","for_page","global","national","regional","local"],function(e){r[e]=function(){var t=new n;return t[e].apply(t,arguments)}}),r}(),define("main/chart_helper",function(){}),window.Reverb||(window.Reverb={}),Reverb.GeoLocation=function(){var e=function(e){var t="/main/change_location?action_forward=trigger_updated_object";e===!1&&(t+="&no_session=true"),window.modal_open(t)},t=function(e){var t=[];return e&&(e.city&&t.push(e.city),e.state&&t.push(e.state),e.country&&t.push(e.country)),t.join(", ")},n=function(e){var t=[];return t.push(e.city||""),t.push(e.state||""),t.push(e.country||""),t.join("_")};return{show_modal:e,display_string_for_location:t,region_string_for_location:n}}(),define("main/geo_location_utils",function(){}),define("common/angular/directives/rn_select2",["module","angular_helper"],function(e,t){var n=t.createModule(arguments);return n.directive("rnSelect2",["$window","$parse",function(e,t){return{restrict:"A",link:function(n,r,o){var a={};if(o.forModal&&(a.dropdownCssClass="select2-drop--in-modal"),o.rnSelect2&&o.rnSelect2.length){var i=angular.fromJson(o.rnSelect2);i.formatResult&&(i.formatResult=n[i.formatResult]),_.extend(a,i)}var l=function(){r.select2("destroy").select2(a).on("select2-open",function(){if(o.forModal&&angular.element("#select2-drop-mask").addClass("select2-drop-mask--in-modal"),o.rnSelect2Footer){var e=r.select2("dropdown"),a=e.find("#select2-appended-footer");0==a.length&&(a=angular.element('<div id="select2-appended-footer"><hr style="margin:5px 6px 0 6px;border: none;border-top: 1px solid #EDF0F1;"/><div class="select2-results"><div class="select2-result-label">'+o.rnSelect2Footer+"</div></div></div>"),o.rnSelect2FooterOnclick&&a.find(".select2-results").on("click",function(){r.select2("close"),n.$evalAsync(function(){t(o.rnSelect2FooterOnclick)(n)})}),e.append(a))}jQuery(document).foundation("dropdown","closeall")}).on("select2-close",function(){o.forModal&&angular.element("#select2-drop-mask").removeClass("select2-drop-mask--in-modal")})},c=/iPad|iPhone|iPod/gi.test(e.navigator.userAgent);c&&o.forModal||(n.$watchCollection(function(){var e=_.map(r.find("option"),function(e){return angular.element(e).val()});return e},l),o.rnSelect2OnChange&&n.$watch(function(){return n.$eval(o.rnSelect2OnChange)},l)),o.multiple&&n.$watch(function(){return r.select2("val").length},function(e){var t=r.select2("container").find("li.select2-search-choice").length;t!==e&&r.select2()},!0)}}}]),n.directive("rnSelect2OpenIf",["$timeout",function(e){return{restrict:"A",link:function(t,n,r){t.$watch(r.rnSelect2OpenIf,function(t){t&&e(function(){n.select2("open")})})}}}]),n.directive("rnSelect2Open",[function(){return{restrict:"A",link:function(e,t,n){var r=function(){e.$evalAsync(n.rnSelect2Open)};t.on("select2-open.rnSelect2Open",r)}}}]),n.directive("rnSelect2CloseIf",[function(){return{restrict:"A",link:function(e,t,n){e.$watch(n.rnSelect2CloseIf,function(n){n&&e.$evalAsync(t.select2("close"))})}}}]),n.directive("rnSelect2Close",[function(){return{restrict:"A",link:function(e,t,n){var r=function(){e.$evalAsync(n.rnSelect2Close)};t.on("select2-close.rnSelect2Close",r)}}}]),n.directive("rnSelect2Blur",[function(){return{restrict:"A",link:function(e,t,n){var r=function(){e.$evalAsync(n.rnSelect2Blur)};t.on("select2-blur.rnSelect2Blur",r)}}}]),n}),define("common/angular/directives/autocomplete",["module","angular_helper"],function(e,t){var n=t.createModule(arguments);return n.directive("ngAutocomplete",["$parse",function(){return{require:"ngModel",scope:{ngModel:"=",options:"=?",details:"=?"},link:function(e,t,n,r){Reverb.GMaps.ready(function(){var n,o=!1,a=function(){n={},e.options&&(o=e.options.watchEnter!==!0?!1:!0,e.options.types?(n.types=[],n.types.push(e.options.types),e.gPlace.setTypes(n.types)):e.gPlace.setTypes([]),e.options.bounds?(n.bounds=e.options.bounds,e.gPlace.setBounds(n.bounds)):e.gPlace.setBounds(null),e.options.country?(n.componentRestrictions={country:e.options.country},e.gPlace.setComponentRestrictions(n.componentRestrictions)):e.gPlace.setComponentRestrictions(null))};void 0==e.gPlace&&(e.gPlace=new google.maps.places.Autocomplete(t[0],{})),google.maps.event.addListener(e.gPlace,"place_changed",function(){var n=e.gPlace.getPlace();void 0!==n&&(void 0!==n.address_components?e.$apply(function(){e.details=n,r.$setViewValue(t.val())}):o&&i(n))});var i=function(n){var o=new google.maps.places.AutocompleteService;n.name.length>0&&o.getPlacePredictions({input:n.name,offset:n.name.length},function(n){if(null==n||0==n.length)e.$apply(function(){e.details=null});else{var o=new google.maps.places.PlacesService(t[0]);o.getDetails({reference:n[0].reference},function(n,o){o==google.maps.GeocoderStatus.OK&&e.$apply(function(){r.$setViewValue(n.formatted_address),t.val(n.formatted_address),e.details=n;t.on("focusout",function(){t.val(n.formatted_address),t.unbind("focusout")})})})}})};r.$render=function(){var e=r.$viewValue;t.val(e)},e.watchOptions=function(){return e.options},e.$watch(e.watchOptions,function(){a()},!0)})}}}])}),define("charts/controllers/chart",["module","angular_helper","main/local_scene_helper","main/chart_helper","main/geo_location_utils","common/angular/directives/rn_select2","common/angular/directives/autocomplete"],function(e,t){var n=t.createModule(arguments),r=["$scope","$http","$location","$window","Config"],o=function(e,t,n,r,o){e.artists=[],e.fullCharts=o.full_charts,e.chartTitle=o.chartTitle,e.spinnerClass="hidden",e.loading=!1,e.default_url=Reverb.staticCacheServer()+"/images/v3/standard_resources/default_images/artist_small.png",e.tracking=e.fullCharts?"":"HomePage.Click",e.showFilters=o.showFilters,e.filters=angular.copy(o.filters,{}),e.page=o.page,e.per_page=o.per_page,e.countries=o.countries,e.regions=o.regions,e.genreOptions=o.genreOptions,e.geoOptions=[{label:"Global",value:Reverb.ChartHelper.GEO_TYPES.GLOBAL},{label:"National",value:Reverb.ChartHelper.GEO_TYPES.NATIONAL},{label:"Regional",value:Reverb.ChartHelper.GEO_TYPES.REGIONAL},{label:"Local",value:Reverb.ChartHelper.GEO_TYPES.LOCAL}],0==o.regions.length&&e.geoOptions.splice(2,1),e.autocomplete_local={formatted_address:Reverb.GeoLocation.display_string_for_location(e.filters.location)},e.autocomplete_region={},e.mixpanelTracking=o.mixpanelTracking,e.disableTap=function(e){var t=document.getElementsByClassName("pac-container");angular.element(t).on("click",function(){document.getElementById(e).blur()})},e.disableUpdateButtonForLocal=function(){e.updateButtonEnabledForLocal=!1},e.disableUpdateButtonForRegional=function(){e.updateButtonEnabledForRegional=!1},e.toggleFilters=function(){e.showFilters=!e.showFilters,e.showFilters||(e.pendingLocation=null)},e.updateFilters=function(){e.pendingLocation&&(e.filters.location=e.filters.location||{},e.filters.location.geo=e.pendingLocation.geo||e.filters.geo||Reverb.ChartHelper.GEO_TYPES.LOCAL,e.filters.location.city=e.pendingLocation.city,e.filters.location.state=e.pendingLocation.state,e.filters.location.country=e.pendingLocation.country,e.filters.location.postal_code=e.pendingLocation.postal_code,e.filters.location.region=e.pendingLocation.region,e.filters.location.latitude=e.pendingLocation.latitude,e.filters.location.longitude=e.pendingLocation.longitude,e.filters.location.geo===Reverb.ChartHelper.GEO_TYPES.LOCAL&&Reverb.Event.trigger("charts:refresh_sponsored_artists",e.filters.location),setTimeout(function(){r.jQuery("select[name=geo]").trigger("change")},50)),e.artist_id=0,e.artist_name="",i=angular.copy(e.filters,{}),e.setPage(1),e.showFilters&&e.toggleFilters(),e.updateChartTitle(),e.mixpanelTrackAndUpdate("Charts.ChartChanged")},e.mixpanelTrackAndUpdate=function(t){if(e.mixpanelTracking){var n=angular.extend({},e.mixpanelTracking);n.chart_type_after&&(n.chart_type_before=n.chart_type_after),n.chart_nation_after&&(n.chart_nation_before=n.chart_nation_after),n.chart_region_after&&(n.chart_region_before=n.chart_region_after),n.chart_genre_after&&(n.chart_genre_before=n.chart_genre_after);var r=_.filter(e.regions,function(t){return t.value==e.filters.location.region})[0],o=r?r.label:"";n.chart_type_after=e.filters.location.geo,n.chart_nation_after=e.filters.location.country,n.chart_genre_after=e.filters.genre,n.chart_region_after=o,e.mixpanelTracking=n,Reverb.Mixpanel.track(t,n)}};var a=function(t,n){var r=function(e){return Math.pow(Math.pow(e.lat-t,2)+Math.pow(e.lng-n,2),.5)},o=_.filter(e.regions,function(e){return r(e)<=2}).sort(function(e,t){return r(e)-r(t)});return o[0]};e.$watch("autocomplete_local.temp_place",function(t){if(t){var n={geo:Reverb.ChartHelper.GEO_TYPES.LOCAL,city:"",state:"",postal_code:"",country:"",region:null,latitude:t.geometry.location.lat(),longitude:t.geometry.location.lng()};if(_.each(t.address_components,function(e){var t=e.types,r=e.short_name;r&&(t.include("locality")?n.city=r:t.include("administrative_area_level_1")?n.state=r:t.include("postal_code")?n.postal_code=r:t.include("country")&&(n.country=r.replace("GB","UK")))}),""==n.city)n.geo=Reverb.ChartHelper.GEO_TYPES.NATIONAL;else{var r=a(n.latitude,n.longitude);r&&(n.region=r.value)}e.pendingLocation=n,e.updateButtonEnabledForLocal=!0}}),e.$watch("autocomplete_region.temp_place",function(t){if(t&&t.geometry){var n=t.geometry.location;if(n){var r=n.lat(),o=n.lng(),i=a(r,o),l={city:"",state:"",postal_code:"",country:"",region:null,latitude:r,longitude:o};if(i)l.geo=Reverb.ChartHelper.GEO_TYPES.REGIONAL,l.region=i.value;else if(t.address_components){var c=t.address_components.last();l.geo=Reverb.ChartHelper.GEO_TYPES.NATIONAL,l.country=c.short_name.replace("GB","UK")}e.pendingLocation=l,e.updateButtonEnabledForRegional=!0}}}),e.getChartHelperObject=function(){var t=null;switch(e.filters.location.geo){case Reverb.ChartHelper.GEO_TYPES.GLOBAL:t=Reverb.ChartHelper.global();break;case Reverb.ChartHelper.GEO_TYPES.LOCAL:t=Reverb.ChartHelper.local().for_geo_location(e.filters.location);break;case Reverb.ChartHelper.GEO_TYPES.NATIONAL:t=Reverb.ChartHelper.national(e.filters.location.country);break;case Reverb.ChartHelper.GEO_TYPES.REGIONAL:t=Reverb.ChartHelper.regional(e.filters.location.region)}return t||(t=e.filters.location.country?e.filters.location.city?Reverb.ChartHelper.local().for_geo_location(e.filters.location):Reverb.ChartHelper.national(e.filters.location.country):Reverb.ChartHelper.global()),"all"!==e.filters.genre&&t.for_genre(e.filters.genre),t.for_page(e.page),t},e.getBookmarkParams=function(){return e.getChartHelperObject().params()},e.updateBookmark=function(){e.fullCharts&&(n.replace(),_.each(Reverb.ChartHelper.PARAM_KEYS,function(e){n.search(e,null)}),n.search(e.getBookmarkParams()))};[Reverb.ChartHelper.PARAM_KEYS.GEO_TYPE,Reverb.ChartHelper.PARAM_KEYS.GEO_COUNTRY,Reverb.ChartHelper.PARAM_KEYS.GEO_STATE,Reverb.ChartHelper.PARAM_KEYS.GEO_CITY];e.updateChartTitle=function(){var t=i.location;if(t.geo==Reverb.ChartHelper.GEO_TYPES.NATIONAL){var n=_.filter(e.countries,function(e){return e.value==t.country})[0],r=n?n.label:"";e.locationTitle=r,e.locationCity="",e.locationSubtitle="",e.subheading="Charts for "+r}else if(t.geo==Reverb.ChartHelper.GEO_TYPES.REGIONAL){var o=_.filter(e.regions,function(e){return e.value==t.region})[0],a=o?o.label:"";e.locationTitle=a,e.locationCity="",e.locationSubtitle="Regional",e.subheading="Regional charts for "+a}else if(t.geo==Reverb.ChartHelper.GEO_TYPES.LOCAL){var l=Reverb.GeoLocation.display_string_for_location(t);e.locationCity=t.city,e.locationTitle=l,e.locationSubtitle="",e.subheading="Local charts for "+l}else e.locationTitle="Global",e.locationCity="",e.locationSubtitle="",e.subheading="Global Charts."};var i=angular.copy(e.filters,{});e.getTotalItems=function(){return e.pagination?e.pagination.result_count:-1},e.needsPagination=function(){return e.fullCharts&&e.getTotalItems()>o.per_page},e.setPage=function(t){e.loading=!0,e.page=t,e.updateBookmark(),l(i)},e.isLocal=function(){return i.location&&i.location.geo==Reverb.ChartHelper.GEO_TYPES.LOCAL},e.localShowsUrl=function(){return Reverb.LocalSceneHelper.for_geo_location(i.location).url()},e.isConnectedToArtist=function(e,t){return e.connections&&e.connections.to_obj?e.connections.to_obj.include(t):!1
};var l=function(n){var a="/api/charts/";if(a+=n.location&&n.location.geo&&Object.values(Reverb.ChartHelper.GEO_TYPES).indexOf(n.location.geo)>-1?n.location.geo:Reverb.ChartHelper.GEO_TYPES.GLOBAL,n.location){var i=angular.copy(n,{});i.location.city=void 0,i.location.state=void 0,i.location.postal_code=void 0,n=i}e.spinnerClass="",t({method:"POST",url:a,data:angular.extend({},n,{page:e.page,per_page:o.per_page})}).success(function(t){e.pagination=t.pagination,e.artists=t.results,e.loading=!1,e.spinnerClass="hidden",e.fullCharts?r.scrollTo(0,0):setTimeout(function(){Reverb.History.restore_scroll_position(!0)},100)})};e.updateChartTitle(),l(i),e.mixpanelTrackAndUpdate("Charts.PageViewed"),e.$on("reverb:location:validated",function(t,n,r){e.pendingLocation=r,e.fullCharts||e.updateFilters()}),e.fullChartsUrl=function(){return e.getChartHelperObject().url()},e.clickSlat=function(e,t){var n=r.jQuery(e.target);n.is("a")||e.isDefaultPrevented()||Reverb.Navigate.go_to_page_url("/"+t)}};return r.push(o),n.controller("ChartCtrl",r),n}),define("charts/controllers/all",["module","angular_helper","common/angular/config/disable_autoscroll","common/angular/config/query_param_skips_navigation","charts/controllers/chart"],function(e,t){return t.createModule(arguments)}),define("common/angular/directives/dropdown",["module","angular_helper"],function(e,t){var n,r=t.createModule(arguments),o=["$document","$timeout",function(e,t){return{restrict:"A",link:function(){t.cancel(n),n=t(function(){e.foundation("reflow","dropdown")},0,!1)}}}];return r.directive("dropdown",o),r.directive("dropdownContent",o),r}),define("charts/directives/all",["module","angular_helper","common/angular/directives/dropdown"],function(e,t){return t.createModule(arguments)}),define("charts/config",["module","angular_helper"],function(e,t){return t.createModule(arguments).config(["ConfigProvider",function(e){e.setConfig({showFilters:!1,filters:{genre:"all",location:{geo:"Global"},genre:"All"},page:1,per_page:10,chartTitle:"Local Charts"})}])}),define("charts/app",["module","angular_helper","common/angular/main_site_essential","common/angular/components/pagination","common/angular/directives/err_src","common/angular/directives/event_listener","common/filters","common/angular/config/config","charts/controllers/all","charts/directives/all","charts/config"],function(e,t){return t.createModule(arguments,"Charts.Templates").run(["$rootElement","$rootScope",function(e,t){angular.element(e).on("$destroy",angular.bind(t,t.$destroy))}])}),define("charts/bootstrap",["module","angular_helper","charts/app"],function(e,t){return t.configBootstrapper(arguments)}),define("modules/charts",["charts/bootstrap"],function(e){return e});